<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                    },
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 dark:bg-gray-900">
    <!-- Sidebar -->
    <aside id="sidebar" class="fixed top-0 left-0 z-40 w-64 h-screen transition-transform -translate-x-full sm:translate-x-0">
        <div class="h-full px-3 py-4 overflow-y-auto bg-white dark:bg-gray-800">
            <div class="flex items-center mb-5">
                <span class="text-2xl font-semibold text-gray-800 dark:text-white">Dashboard</span>
            </div>
            <ul class="space-y-2">
                <li>
                    <button data-tab="campaigns" class="tab-btn flex items-center w-full p-2 text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 group">
                        <svg class="w-5 h-5 text-gray-500 dark:text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"/>
                        </svg>
                        <span class="ml-3">Campaigns</span>
                    </button>
                </li>
                <li>
                    <button data-tab="analytics" class="tab-btn flex items-center w-full p-2 text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 group">
                        <svg class="w-5 h-5 text-gray-500 dark:text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                        <span class="ml-3">Analytics</span>
                    </button>
                </li>
                <li>
                    <button data-tab="settings" class="tab-btn flex items-center w-full p-2 text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 group">
                        <svg class="w-5 h-5 text-gray-500 dark:text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                        <span class="ml-3">Settings</span>
                    </button>
                </li>
                <li>
                    <button data-tab="gmail" class="tab-btn flex items-center w-full p-2 text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 group">
                        <svg class="w-5 h-5 text-gray-500 dark:text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                        </svg>
                        <span class="ml-3">Gmail Integration</span>
                    </button>
                </li>
                <li>
                    <button data-tab="campaigns-manager" class="tab-btn flex items-center w-full p-2 text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 group">
                        <svg class="w-5 h-5 text-gray-500 dark:text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                        </svg>
                        <span class="ml-3">Campaign Manager</span>
                    </button>
                </li>
            </ul>
        </div>
    </aside>

    <!-- Main content -->
    <div class="p-4 sm:ml-64">
        <!-- Top bar -->
        <div class="flex justify-between items-center mb-4 bg-white dark:bg-gray-800 p-4 rounded-lg shadow">
            <div class="flex items-center">
                <button id="sidebar-toggle" class="sm:hidden text-gray-500 dark:text-gray-400 mr-4">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                    </svg>
                </button>
                <div class="flex space-x-4">
                    <div class="text-sm text-gray-600 dark:text-gray-300">
                        <span class="font-medium">Active Campaigns:</span> 
                        <span class="ml-1">12</span>
                    </div>
                    <div class="text-sm text-gray-600 dark:text-gray-300">
                        <span class="font-medium">Total Leads:</span> 
                        <span class="ml-1">1,234</span>
                    </div>
                    <div class="text-sm text-gray-600 dark:text-gray-300">
                        <span class="font-medium">Success Rate:</span> 
                        <span class="ml-1">67%</span>
                    </div>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <button id="theme-toggle" class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5">
                    <svg id="theme-toggle-dark-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
                    </svg>
                    <svg id="theme-toggle-light-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"></path>
                    </svg>
                </button>
            </div>
        </div>


        <!-- Tab content -->
        <div id="campaigns" class="tab-content">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                <h2 class="text-xl font-bold mb-4 text-gray-900 dark:text-white">New Drip Campaign</h2>
                <div class="mb-6">
                    <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Upload Leads Excel File</label>
                    <div class="flex items-center justify-center w-full">
                        <label for="excel-upload" class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 dark:hover:bg-gray-800 dark:bg-gray-700 hover:bg-gray-100 dark:border-gray-600 dark:hover:border-gray-500">
                            <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                <svg class="w-8 h-8 mb-4 text-gray-500 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                </svg>
                                <p class="mb-2 text-sm text-gray-500 dark:text-gray-400"><span class="font-semibold">Click to upload</span> or drag and drop</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400">XLSX or XLS files only</p>
                            </div>
                            <div id="file-name" class="hidden mt-2 text-sm text-gray-500 dark:text-gray-400"></div>
                            <input id="excel-upload" type="file" class="hidden" accept=".xlsx,.xls" />
                        </label>
                    </div>
                </div>
                 <div id="campaign-actions" class="mb-4 hidden">
                    <div class="flex items-center justify-between">

                        <!-- <button id="start-campaign" class="px-4 py-2 bg-blue-600 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-blue-700 transition-colors">
                            Start Campaign
                        </button> -->
                    </div>
                </div> 

                <div id="leads-skeleton" class="hidden">
                    <div class="animate-pulse space-y-4">
                        <div class="h-10 bg-gray-200 dark:bg-gray-700 rounded w-full"></div>
                        <div class="space-y-3">
                            <div class="h-8 bg-gray-200 dark:bg-gray-700 rounded"></div>
                            <div class="h-8 bg-gray-200 dark:bg-gray-700 rounded"></div>
                            <div class="h-8 bg-gray-200 dark:bg-gray-700 rounded"></div>
                            <div class="h-8 bg-gray-200 dark:bg-gray-700 rounded"></div>
                        </div>
                    </div>
                </div>

                <div id="leads-table" class="overflow-x-auto hidden">
                    <!-- Table will be populated by JavaScript -->
                </div>

                <div id="campaign-preview" class="hidden mt-6">
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6">
                        <h3 class="text-lg font-semibold mb-4 text-gray-900 dark:text-white">Campaign Preview</h3>
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Campaign Name</label>
                                    <input type="text" class="w-full p-2 border rounded-lg dark:bg-gray-800 dark:border-gray-600 dark:text-white" placeholder="Enter campaign name">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Send Date</label>
                                    <input type="datetime-local" class="w-full p-2 border rounded-lg dark:bg-gray-800 dark:border-gray-600 dark:text-white">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Email Template</label>
                                <select class="w-full p-2 border rounded-lg dark:bg-gray-800 dark:border-gray-600 dark:text-white">
                                    <option value="template1">Medical Device Introduction</option>
                                    <option value="template2">Product Demo Request</option>
                                    <option value="template3">Follow-up Meeting</option>
                                </select>
                            </div>
                            <div id="email-preview" class="border rounded-lg p-4 bg-white dark:bg-gray-800 dark:border-gray-600">
                                <div class="mb-2 text-sm text-gray-600 dark:text-gray-400">Preview:</div>
                                <div class="prose dark:prose-invert max-w-none">
                                    <p>Dear [Company Name],</p>
                                    <p>I hope this email finds you well. I'm reaching out because I noticed your company's impressive work in the medical device industry, particularly with your revenue range of $10M-$50M.</p>
                                    <p>Would you be interested in learning more about how our solutions can help optimize your operations and potentially increase your EBITDA beyond the current 20%?</p>
                                    <p>Best regards,<br>[Sender Name]</p>
                                </div>
                            </div>
                            <div class="flex justify-end space-x-4">
                                <button class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 dark:text-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700">Save Draft</button>
                                <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Send Campaign</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="analytics" class="tab-content hidden">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                <h2 class="text-xl font-bold mb-4 text-gray-900 dark:text-white">Analytics Dashboard</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div class="bg-blue-100 dark:bg-blue-900 p-4 rounded-lg">
                        <h3 class="font-semibold text-blue-800 dark:text-blue-200">Total Leads</h3>
                        <p class="text-2xl font-bold text-blue-900 dark:text-blue-100">1,234</p>
                    </div>
                    <div class="bg-green-100 dark:bg-green-900 p-4 rounded-lg">
                        <h3 class="font-semibold text-green-800 dark:text-green-200">Conversion Rate</h3>
                        <p class="text-2xl font-bold text-green-900 dark:text-green-100">23.5%</p>
                    </div>
                    <div class="bg-purple-100 dark:bg-purple-900 p-4 rounded-lg">
                        <h3 class="font-semibold text-purple-800 dark:text-purple-200">Active Campaigns</h3>
                        <p class="text-2xl font-bold text-purple-900 dark:text-purple-100">5</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gmail Integration Content -->
<div id="gmail" class="tab-content hidden">
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
        <h2 class="text-xl font-bold mb-4 text-gray-900 dark:text-white">Gmail Integration</h2>
        
        <!-- Current Status Card -->
        <div class="mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="font-semibold text-blue-800 dark:text-blue-200">Gmail Account Status</h3>
                    <p id="gmail-status" class="text-blue-600 dark:text-blue-300 mt-1">
                        <span id="no-accounts" class="flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                            </svg>
                            No Gmail accounts connected
                        </span>
                        <span id="accounts-connected" class="hidden">
                            <span id="accounts-count" class="font-bold">0</span> Gmail accounts connected
                        </span>
                    </p>
                </div>
                <button id="connect-gmail" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                    Connect Gmail
                </button>
            </div>
        </div>
        
        <!-- Connected Accounts -->
        <div id="gmail-accounts" class="mb-6">
            <h3 class="font-semibold text-gray-900 dark:text-white mb-3">Connected Accounts</h3>
            <div id="accounts-list" class="space-y-3">
                <!-- Connected accounts will be inserted here -->
                <div class="text-gray-500 dark:text-gray-400 text-sm" id="no-accounts-message">
                    No Gmail accounts connected yet. Click "Connect Gmail" to add an account.
                </div>
            </div>
        </div>
        
        <!-- Test Connection -->
        <div id="test-connection-section" class="mb-6 hidden">
            <h3 class="font-semibold text-gray-900 dark:text-white mb-3">Test Connection</h3>
            <div class="flex items-center space-x-4">
                <select id="test-email-account" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white">
                    <!-- Options will be populated dynamically -->
                </select>
                <button id="test-connection" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                    Test Connection
                </button>
            </div>
            <div id="test-result" class="mt-3 hidden p-3 rounded-lg">
                <!-- Test results will appear here -->
            </div>
        </div>
    </div>
</div>

<!-- Campaign Manager Content -->
<div id="campaigns-manager" class="tab-content hidden">
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold text-gray-900 dark:text-white">Campaign Manager</h2>
            <button id="create-campaign" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
                Create Campaign
            </button>
        </div>
        
        <!-- Campaigns List -->
        <div class="mb-6">
            <h3 class="font-semibold text-gray-900 dark:text-white mb-3">Your Campaigns</h3>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                    <thead class="bg-gray-50 dark:bg-gray-700">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                Name
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                Status
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                Leads
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                Sent
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                Next Follow-up
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                Actions
                            </th>
                        </tr>
                    </thead>
                    <tbody id="campaigns-list" class="bg-white divide-y divide-gray-200 dark:bg-gray-800 dark:divide-gray-700">
                        <!-- Campaigns will be listed here -->
                        <tr>
                            <td colspan="6" class="px-6 py-4 text-center text-gray-500 dark:text-gray-400">
                                No campaigns created yet.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>




  <!-- Verification Modal Template -->
<template id="verification-modal-template">
    <div id="verification-modal" class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen">
        <div class="fixed inset-0 transition-opacity" aria-hidden="true">
          <div class="absolute inset-0 bg-black bg-opacity-50"></div>
        </div>
        
        <div class="relative bg-white dark:bg-gray-800 rounded-lg max-w-md w-full mx-auto p-6 shadow-xl">
          <div class="text-center">
            <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
              Verifying Email Addresses
            </h3>
            <div class="mb-3">
              <div class="w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700">
                <div class="progress-bar bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
              </div>
            </div>
            <p class="progress-text text-sm text-gray-500 dark:text-gray-400">
              Processing leads...
            </p>
            <div class="animate-pulse flex justify-center mt-4">
              <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
              </svg>
            </div>
            <p class="mt-2 text-xs text-gray-500 dark:text-gray-400">
              This may take a few minutes depending on the number of leads.
            </p>
          </div>
        </div>
      </div>
    </div>
  </template>
  
  <!-- Verified Campaign Template -->
  <template id="verified-campaign-template">
    <div id="verified-campaign-modal" class="fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen py-4">
        <div class="fixed inset-0 transition-opacity" aria-hidden="true">
          <div class="absolute inset-0 bg-black bg-opacity-50"></div>
        </div>
        
        <div class="relative bg-white dark:bg-gray-800 rounded-lg max-w-5xl w-full mx-auto shadow-xl overflow-hidden">
          <div class="px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-lg font-medium text-gray-900 dark:text-white">
                Create Campaign with Verified Leads
              </h3>
              <button class="close-modal text-gray-400 hover:text-gray-500">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
            
            <div class="overflow-y-auto" style="max-height: calc(100vh - 200px);">
              <form id="verified-campaign-form" class="space-y-6">
                <!-- Campaign content will be added dynamically -->
              </form>
            </div>
          </div>
          
          <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
            <button type="button" id="create-verified-campaign" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm">
              Create Campaign
            </button>
            <button type="button" class="close-modal mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-700 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>
  </template>
  
  <!-- Follow-up Email Template -->
  <template id="follow-up-template">
    <div class="follow-up-email border rounded-lg p-4 dark:border-gray-600">
      <div class="flex justify-between items-center mb-3">
        <h5 class="font-medium text-gray-900 dark:text-white">Follow-up Email <span class="follow-up-number">1</span></h5>
        <button type="button" class="remove-follow-up text-red-600 hover:text-red-800 dark:text-red-400">
          <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
          </svg>
        </button>
      </div>
      <div class="space-y-3">
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
            Email Subject
          </label>
          <input type="text" class="email-subject w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Enter email subject">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
            Email Body
          </label>
          <textarea class="email-body w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white" rows="6" placeholder="Enter email body"></textarea>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
            Wait Duration
          </label>
          <div class="grid grid-cols-2 gap-2">
            <input type="number" class="wait-duration w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white" min="1" value="3">
            <select class="wait-unit w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
              <option value="hours">Hours</option>
              <option value="days" selected>Days</option>
              <option value="weeks">Weeks</option>
            </select>
          </div>
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
            Time to wait after previous email before sending this one
          </p>
        </div>
      </div>
    </div>
  </template>
  
  <!-- Campaign Modal -->
  <div id="campaign-modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black bg-opacity-50"></div>
    <div class="relative top-20 mx-auto p-5 w-full max-w-4xl bg-white dark:bg-gray-800 rounded-lg shadow-xl">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-semibold text-gray-900 dark:text-white">Create New Campaign</h3>
        <button id="close-campaign-modal" class="text-gray-400 hover:text-gray-500">
          <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      
      <div class="overflow-y-auto" style="max-height: calc(100vh - 200px);">
        <!-- Campaign Setup Form -->
        <form id="campaign-form" class="space-y-6">
          <!-- Basic Info -->
          <div>
            <h4 class="font-medium text-gray-900 dark:text-white mb-3">Campaign Information</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                  Campaign Name
                </label>
                <input type="text" id="campaign-name" class="w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Enter campaign name">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                  Sending Account
                </label>
                <select id="sending-account" class="w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                  <option value="">Select Gmail account</option>
                  <!-- Accounts will be populated here -->
                </select>
              </div>
            </div>
          </div>
          
          <!-- Lead Selection -->
          <div>
            <h4 class="font-medium text-gray-900 dark:text-white mb-3">Lead Selection</h4>
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                Select Leads
              </label>
              <select id="lead-source" class="w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                <option value="current">Use current leads from data table</option>
                <option value="upload">Upload new leads file</option>
              </select>
            </div>
            <div id="lead-upload-container" class="mt-3 hidden">
              <label for="lead-file" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                Upload Leads File
              </label>
              <input type="file" id="lead-file" class="hidden" accept=".xlsx,.xls,.csv">
              <label for="lead-file" class="flex items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 dark:hover:bg-gray-800 dark:bg-gray-700 hover:bg-gray-100 dark:border-gray-600 dark:hover:border-gray-500">
                <div class="flex flex-col items-center justify-center pt-5 pb-6">
                  <svg class="w-8 h-8 mb-4 text-gray-500 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                  </svg>
                  <p class="mb-2 text-sm text-gray-500 dark:text-gray-400"><span class="font-semibold">Click to upload</span> or drag and drop</p>
                  <p class="text-xs text-gray-500 dark:text-gray-400">XLSX, XLS, or CSV files only</p>
                </div>
              </label>
            </div>
          </div>
          
          <!-- Email Sequence -->
          <div>
            <div class="flex justify-between items-center mb-3">
              <h4 class="font-medium text-gray-900 dark:text-white">Email Sequence</h4>
              <button type="button" id="add-email-step" class="text-blue-600 hover:text-blue-800 dark:text-blue-400 flex items-center text-sm">
                <svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
                Add Follow-up Email
              </button>
            </div>
            
            <!-- Initial Email -->
            <div class="border rounded-lg p-4 mb-3 dark:border-gray-600">
              <div class="flex justify-between items-center mb-3">
                <h5 class="font-medium text-gray-900 dark:text-white">Initial Email</h5>
              </div>
              <div class="space-y-3">
                <div>
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                    Email Subject
                  </label>
                  <input type="text" class="email-subject w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Enter email subject">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                    Email Body
                  </label>
                  <textarea class="email-body w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white" rows="6" placeholder="Enter email body"></textarea>
                  <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                    You can use variables like {first_name}, {company}, {industry}, etc.
                  </p>
                </div>
                <div class="grid grid-cols-2 gap-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                      Send Date
                    </label>
                    <input type="datetime-local" class="email-date w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                      Sending Speed
                    </label>
                    <select class="email-speed w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                      <option value="slow">Slow (1 email per 2 min)</option>
                      <option value="medium" selected>Medium (1 email per min)</option>
                      <option value="fast">Fast (3 emails per min)</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Follow-up Emails Container -->
            <div id="follow-up-container" class="space-y-3">
              <!-- Follow-up emails will be added here -->
            </div>
          </div>
          
          <!-- Campaign Settings -->
          <div>
            <h4 class="font-medium text-gray-900 dark:text-white mb-3">Additional Settings</h4>
            <div class="space-y-3">
              <div class="flex items-center">
                <input type="checkbox" id="track-opens" class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                <label for="track-opens" class="ml-2 block text-sm text-gray-900 dark:text-gray-300">
                  Track email opens
                </label>
              </div>
              <div class="flex items-center">
                <input type="checkbox" id="track-clicks" class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                <label for="track-clicks" class="ml-2 block text-sm text-gray-900 dark:text-gray-300">
                  Track link clicks
                </label>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                  Stop follow-ups if:
                </label>
                <div class="ml-4 space-y-2">
                  <div class="flex items-center">
                    <input type="checkbox" id="stop-on-reply" class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50" checked>
                    <label for="stop-on-reply" class="ml-2 block text-sm text-gray-900 dark:text-gray-300">
                      Recipient replies
                    </label>
                  </div>
                  <div class="flex items-center">
                    <input type="checkbox" id="stop-on-click" class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50" checked>
                    <label for="stop-on-click" class="ml-2 block text-sm text-gray-900 dark:text-gray-300">
                      Recipient clicks a link
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
      
      <div class="flex justify-end space-x-3 mt-6">
        <button id="cancel-campaign" class="px-4 py-2 border border-gray-300 rounded-lg dark:border-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">
          Cancel
        </button>
        <button id="save-campaign" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
          Create Campaign
        </button>
      </div>
    </div>
  </div>


        <div id="settings" class="tab-content hidden">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                <h2 class="text-xl font-bold mb-4 text-gray-900 dark:text-white">Settings</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Email Notifications</label>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" class="sr-only peer" checked>
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                            <span class="ml-3 text-sm font-medium text-gray-900 dark:text-gray-300">Enable email notifications</span>
                        </label>
                    </div>
                    <div>
                        <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Language</label>
                        <select class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white">
                            <option value="en">English</option>
                            <option value="es">Spanish</option>
                            <option value="fr">French</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script src="sapna.js"></script>
    <script>
        //     // Theme toggle
        //     const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
        //     const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');
        //     const themeToggleBtn = document.getElementById('theme-toggle');
        
        //     // Change the icons inside the button based on previous settings
        //     if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        //         themeToggleLightIcon.classList.remove('hidden');
        //         document.documentElement.classList.add('dark');
        //     } else {
        //         themeToggleDarkIcon.classList.remove('hidden');
        //         document.documentElement.classList.remove('dark');
        //     }
        
        //     themeToggleBtn.addEventListener('click', function() {
        //         // Toggle icons
        //         themeToggleDarkIcon.classList.toggle('hidden');
        //         themeToggleLightIcon.classList.toggle('hidden');
        
        //         // If is set in localStorage
        //         if (localStorage.getItem('color-theme')) {
        //             if (localStorage.getItem('color-theme') === 'light') {
        //                 document.documentElement.classList.add('dark');
        //                 localStorage.setItem('color-theme', 'dark');
        //             } else {
        //                 document.documentElement.classList.remove('dark');
        //                 localStorage.setItem('color-theme', 'light');
        //             }
        //         } else {
        //             if (document.documentElement.classList.contains('dark')) {
        //                 document.documentElement.classList.remove('dark');
        //                 localStorage.setItem('color-theme', 'light');
        //             } else {
        //                 document.documentElement.classList.add('dark');
        //                 localStorage.setItem('color-theme', 'dark');
        //             }
        //         }
        //     });
        
        //     // Sidebar toggle
        //     const sidebarToggle = document.getElementById('sidebar-toggle');
        //     const sidebar = document.getElementById('sidebar');
        
        //     sidebarToggle.addEventListener('click', () => {
        //         sidebar.classList.toggle('-translate-x-full');
        //     });
        
        //     // Tab switching
        //     const tabButtons = document.querySelectorAll('.tab-btn');
        //     const tabContents = document.querySelectorAll('.tab-content');
        
        //     tabButtons.forEach(button => {
        //         button.addEventListener('click', () => {
        //             const tabId = button.getAttribute('data-tab');
                    
        //             // Hide all tab contents
        //             tabContents.forEach(content => {
        //                 content.classList.add('hidden');
        //             });
                    
        //             // Show selected tab content
        //             document.getElementById(tabId).classList.remove('hidden');
                    
        //             // Update active state of tab buttons
        //             tabButtons.forEach(btn => {
        //                 btn.classList.remove('bg-gray-100', 'dark:bg-gray-700');
        //             });
        //             button.classList.add('bg-gray-100', 'dark:bg-gray-700');
        //         });
        //     });
        
        
        // // File handling state
        // let currentFile = null;
        // let selectedLeads = new Set();
        
        // // DOM Elements
        // const dropZone = document.querySelector('label[for="excel-upload"]');
        // const fileInput = document.getElementById('excel-upload');
        // const fileNameDisplay = document.getElementById('file-name');
        // const leadsTable = document.getElementById('leads-table');
        // const campaignActions = document.getElementById('campaign-actions');
        // const leadsSkeleton = document.getElementById('leads-skeleton');
        // const campaignPreview = document.getElementById('campaign-preview');
        
        // // File handling functions
        // function handleFileSelection(file) {
        // if (!isValidExcelFile(file)) {
        //     showError('Please upload a valid Excel file (XLSX or XLS)');
        //     resetFileInput();
        //     return;
        // }
        
        // currentFile = file;
        // updateUIForFileSelection(file);
        // // processExcelFile(file);
        // }
        
        // function isValidExcelFile(file) {
        // const validExtensions = ['xlsx', 'xls'];
        // const extension = file.name.split('.').pop().toLowerCase();
        // return validExtensions.includes(extension);
        // }
        
        // function updateUIForFileSelection(file) {
        // // Update file name display
        // fileNameDisplay.textContent = file.name;
        // fileNameDisplay.classList.remove('hidden');
        
        // // Update drop zone appearance
        // dropZone.classList.add('border-green-500', 'bg-green-50', 'dark:bg-gray-600');
        // const uploadText = dropZone.querySelector('p');
        // if (uploadText) {
        //     uploadText.textContent = `File selected: ${file.name}`;
        // }
        
        // // Reset UI after animation
        // setTimeout(() => {
        //     dropZone.classList.remove('border-green-500', 'bg-green-50', 'dark:bg-gray-600');
        // }, 2000);
        // }
        
        // function resetFileInput() {
        // fileInput.value = '';
        // fileNameDisplay.classList.add('hidden');
        // currentFile = null;
        // resetTableUI();
        // }
        
        // function resetTableUI() {
        // leadsSkeleton.classList.add('hidden');
        // leadsTable.classList.add('hidden');
        // campaignActions.classList.add('hidden');
        // campaignPreview.classList.add('hidden');
        // selectedLeads.clear();
        // updateSelectedCount();
        // }
        
        // function showError(message) {
        // // You could implement a proper error notification system here
        // alert(message);
        // }
        
        // // Excel processing
        // async function processExcelFile(file) {
        // showLoadingState();
        
        // try {
        //     const arrayBuffer = await readFileAsArrayBuffer(file);
        //     const workbook = XLSX.read(new Uint8Array(arrayBuffer), { type: 'array' });
            
        //     // Get first worksheet
        //     const worksheetName = workbook.SheetNames[0];
        //     const worksheet = workbook.Sheets[worksheetName];
            
        //     // Convert to JSON
        //     const jsonData = XLSX.utils.sheet_to_json(worksheet);
            
        //     if (jsonData.length === 0) {
        //         throw new Error('No data found in the Excel file');
        //     }
            
        //     createLeadsTable(jsonData);
        // } catch (error) {
        //     showError('Error processing Excel file: ' + error.message);
        //     resetFileInput();
        // } finally {
        //     hideLoadingState();
        // }
        // }
        
        
        // // Helper function to handle Excel file reading
        // // Function to parse Excel data and create proper row objects
        // // Enhanced error handling for Excel processing
        
        // // Enhanced Excel file processing
        // async function handleExcelFile(file) {
        // try {
        //     console.log('Starting Excel file processing:', file.name);
        //     const arrayBuffer = await file.arrayBuffer();
            
        //     const workbook = XLSX.read(new Uint8Array(arrayBuffer), { 
        //         type: 'array',
        //         cellDates: true,
        //         cellNF: false,
        //         cellText: false,
        //         raw: true
        //     });
        
        //     const worksheetName = workbook.SheetNames[0];
        //     const worksheet = workbook.Sheets[worksheetName];
            
        //     // Convert to JSON with row array format
        //     const jsonData = XLSX.utils.sheet_to_json(worksheet, { 
        //         header: 1,
        //         defval: '',
        //         blankrows: false
        //     });
        
        //     console.log('Raw Excel data:', jsonData);
        
        //     // Process each row
        //     const processedData = [];
        //     for (let i = 1; i < jsonData.length; i++) { // Skip header row
        //         const row = jsonData[i];
                
        //         // Skip empty rows
        //         if (!row || !row.some(cell => cell && cell.toString().trim() !== '')) {
        //             continue;
        //         }
        
        //         console.log('Processing row:', row);
        
        //         const rowData = {
        //             company: row[0] || '',
        //             first_name: row[1] || '',
        //             last_name: row[2] || '',
        //             title: row[3] || '',
        //             email_1: row[4] || '',
        //             email_2: row[5] || '',
        //             revenue: row[6] ? formatRevenue(row[6]) : '',
        //             website: row[7] || '',
        //             linkedin: row[8] || '',
        //             industry: row[10] || '',
        //             employees: row[11] || '',
        //             city: row[12] || '',
        //             state: row[13] || ''
        //         };
        
        //         // Validate the row has at least some required fields
        //         if (rowData.company || rowData.first_name || rowData.email_1) {
        //             processedData.push(rowData);
        //             console.log('Added row data:', rowData);
        //         }
        //     }
        
        //     console.log('Processed data:', processedData);
        //     return processedData;
        
        // } catch (error) {
        //     console.error('Error in handleExcelFile:', error);
        //     throw error;
        // }
        // }
        
        // // Format revenue values
        // function formatRevenue(value) {
        // try {
        //     const num = parseFloat(value.toString().replace(/[^0-9.]/g, ''));
        //     if (isNaN(num)) return value;
        //     return new Intl.NumberFormat('en-US', {
        //         style: 'currency',
        //         currency: 'USD',
        //         minimumFractionDigits: 0,
        //         maximumFractionDigits: 0
        //     }).format(num);
        // } catch (error) {
        //     console.error('Error formatting revenue:', error);
        //     return value;
        // }
        // }
        
        
        // // Helper function to clean and validate data
        // function validateAndClean(value, fieldName) {
        // if (value === undefined || value === null) return '';
        
        // // Convert to string and trim
        // const cleaned = value.toString().trim();
        
        // // Field-specific validation
        // switch (fieldName.toLowerCase()) {
        //     case 'email':
        //         return cleaned.toLowerCase();
        //     case 'revenue':
        //         // Handle revenue values with or without currency symbols
        //         const numericValue = cleaned.replace(/[^0-9.]/g, '');
        //         return numericValue ? formatRevenue(numericValue) : '';
        //     default:
        //         return cleaned;
        // }
        // }
        // // Update the file input event listener
        // document.getElementById('excel-upload').addEventListener('change', async function(e) {
        // if (e.target.files.length) {
        //     document.getElementById('leads-skeleton').classList.remove('hidden');
        //     document.getElementById('leads-table').classList.add('hidden');
            
        //     try {
        //         const data = await handleExcelFile(e.target.files[0]);
        //         createLeadsTable(data);
        //     } catch (error) {
        //         showError('Error processing Excel file');
        //     }
        // }
        // });
        
        
        // function readFileAsArrayBuffer(file) {
        // return new Promise((resolve, reject) => {
        //     const reader = new FileReader();
        //     reader.onload = (e) => resolve(e.target.result);
        //     reader.onerror = (e) => reject(new Error('Error reading file'));
        //     reader.readAsArrayBuffer(file);
        // });
        // }
        
        // function showLoadingState() {
        // leadsSkeleton.classList.remove('hidden');
        // leadsTable.classList.add('hidden');
        // campaignPreview.classList.add('hidden');
        // campaignActions.classList.add('hidden');
        // }
        
        // function hideLoadingState() {
        // leadsSkeleton.classList.add('hidden');
        // }
        
        // // Selection handling
        // function setupSelectionHandling() {
        // const selectAllBtn = document.getElementById('select-all');
        // const startCampaignBtn = document.getElementById('start-campaign');
        
        // // Select All button functionality
        // selectAllBtn.addEventListener('click', () => {
        //     const checkboxes = document.querySelectorAll('.lead-checkbox');
        //     const isSelectingAll = selectAllBtn.textContent === 'Select All';
            
        //     checkboxes.forEach(checkbox => {
        //         checkbox.checked = isSelectingAll;
        //         const index = parseInt(checkbox.dataset.index);
        //         if (isSelectingAll) {
        //             selectedLeads.add(index);
        //         } else {
        //             selectedLeads.delete(index);
        //         }
        //     });
            
        //     updateSelectedCount();
        //     selectAllBtn.textContent = isSelectingAll ? 'Deselect All' : 'Select All';
        //     updateHeaderCheckbox(isSelectingAll);
        // });
        
        // // Enable/disable start campaign button based on selection
        // function updateStartCampaignButton() {
        //     startCampaignBtn.disabled = selectedLeads.size === 0;
        // }
        
        // // Observe selected leads changes
        // const updateUI = () => {
        //     const selectedCountElement = document.getElementById('selected-count');
        //     if (selectedCountElement) {
        //         selectedCountElement.textContent = `${selectedLeads.size} leads selected`;
        //     }
        //     updateStartCampaignButton();
        // };
        
        // // Create a proxy to handle selection changes
        // selectedLeads = new Proxy(selectedLeads, {
        //     set(target, property, value) {
        //         target[property] = value;
        //         updateUI();
        //         return true;
        //     }
        // });
        // }
        
        // // Event Listeners
        // function setupEventListeners() {
        // // File drag and drop
        // dropZone.addEventListener('dragover', (e) => {
        //     e.preventDefault();
        //     dropZone.classList.add('border-blue-500', 'bg-blue-50', 'dark:bg-gray-600');
        // });
        
        // dropZone.addEventListener('dragleave', (e) => {
        //     e.preventDefault();
        //     dropZone.classList.remove('border-blue-500', 'bg-blue-50', 'dark:bg-gray-600');
        // });
        
        // dropZone.addEventListener('drop', (e) => {
        //     e.preventDefault();
        //     dropZone.classList.remove('border-blue-500', 'bg-blue-50', 'dark:bg-gray-600');
            
        //     if (e.dataTransfer.files.length) {
        //         handleFileSelection(e.dataTransfer.files[0]);
        //     }
        // });
        
        // // File input change
        // fileInput.addEventListener('change', (e) => {
        //     if (e.target.files.length) {
        //         handleFileSelection(e.target.files[0]);
        //     }
        // });
        // }
        
        // // Initialize
        // function init() {
        // setupEventListeners();
        // // setupSelectionHandling();
        // }
        
        // // Start the application
        // init();
        
        //     // Excel file handling
        //     // document.getElementById('excel-upload').addEventListener('change', async function(e) {
        //     //     // Show skeleton loader
        //     //     document.getElementById('leads-skeleton').classList.remove('hidden');
        //     //     document.getElementById('leads-table').classList.add('hidden');
        //     //     document.getElementById('campaign-preview').classList.add('hidden');
        //     //     document.getElementById('campaign-actions').classList.add('hidden');
        //     //     const file = e.target.files[0];
        //     //     if (file) {
        //     //         const reader = new FileReader();
        //     //         reader.onload = function(e) {
        //     //             const data = new Uint8Array(e.target.result);
        //     //             const workbook = XLSX.read(data, { type: 'array' });
                        
        //     //             // Get first worksheet
        //     //             const worksheetName = workbook.SheetNames[0];
        //     //             const worksheet = workbook.Sheets[worksheetName];
                        
        //     //             // Convert to JSON
        //     //             const jsonData = XLSX.utils.sheet_to_json(worksheet);
                        
        //     //             // Create and populate table
        //     //             createLeadsTable(jsonData);
        //     //         };
        //     //         reader.readAsArrayBuffer(file);
        //     //     }
        //     // });
        
        
        // // Function to find the header row
        // function findHeaderRow(data) {
        // const expectedHeaders = [
        //     'Company',
        //     'First Name',
        //     'Last Name',
        //     'Title',
        //     'Email-1',
        //     'Email-2'
        // ];
        
        // // Convert headers to lowercase for case-insensitive comparison
        // const expectedHeadersLower = expectedHeaders.map(h => h.toLowerCase().replace(/\s+/g, ''));
        
        // // Look for the header row
        // for (let i = 0; i < data.length; i++) {
        //     const row = data[i].map(cell => (cell || '').toString().toLowerCase().replace(/\s+/g, ''));
            
        //     // Check if this row contains our expected headers
        //     const containsHeaders = expectedHeadersLower.every(header => 
        //         row.some(cell => cell.includes(header))
        //     );
        
        //     if (containsHeaders) {
        //         return i;
        //     }
        // }
        
        // return -1;
        // }
        
        // // Modifie
        
        // // Modified cleanData function to handle the specific headers
        // // function cleanData(data) {
        // //     // Define expected headers and their clean versions
        // //     const headerMapping = {
        // //         'Company': 'company',
        // //         'First Name': 'first_name',
        // //         'Last Name': 'last_name',
        // //         'Title': 'title',
        // //         'Email-1': 'email_1',
        // //         'Email-2': 'email_2'
        // //     };
        
        // //     // Get all possible headers from the data
        // //     const allHeaders = new Set();
        // //     data.forEach(row => {
        // //         Object.keys(row).forEach(key => allHeaders.add(key));
        // //     });
        
        // //     return data.map(row => {
        // //         const cleanRow = {};
        // //         // Process each header
        // //         allHeaders.forEach(header => {
        // //             const value = row[header];
        // //             // Use mapped header name if it exists, otherwise clean the header
        // //             const cleanKey = headerMapping[header] || 
        // //                            header.trim()
        // //                                 .toLowerCase()
        // //                                 .replace(/\s+/g, '_')
        // //                                 .replace(/-/g, '_');
                
        // //             // Handle empty or undefined values explicitly
        // //             if (value === undefined || value === null || value === '') {
        // //                 cleanRow[cleanKey] = '';
        // //             } else {
        // //                 // Clean up values
        // //                 cleanRow[cleanKey] = typeof value === 'string' ? value.trim() : value;
        // //             }
        // //         });
        // //         return cleanRow;
        // //     });
        // // }
        
        
        // function cleanData(data) {
        // // Map the empty fields to proper column names based on the screenshot
        // const columnMapping = {
        //     '_empty': 'first_name',
        //     '_empty_1': 'last_name',
        //     '_empty_2': 'title',
        //     '_empty_3': 'email_1',
        //     '_empty_4': 'email_2',
        //     '_empty_5': 'annual_revenue',
        //     '_empty_6': 'website',
        //     '_empty_7': 'linkedin',
        //     '_empty_8': 'notes',
        //     '_empty_9': 'industry',
        //     '_empty_10': 'employees',
        //     '_empty_11': 'city',
        //     '_empty_12': 'state'
        // };
        
        // return data.map(row => {
        //     const cleanedRow = {};
            
        //     // Get the company name from the from/subject field if present
        //     if (row.from) {
        //         const matches = row.from.match(/subject:(.*?):/i);
        //         if (matches && matches[1]) {
        //             cleanedRow.company = matches[1].trim();
        //         }
        //     }
        
        //     // Map each _empty field to its proper column name
        //     Object.entries(columnMapping).forEach(([oldKey, newKey]) => {
        //         if (row[oldKey] !== undefined) {
        //             cleanedRow[newKey] = row[oldKey].toString().trim();
        //         }
        //     });
        
        //     // Format special fields
        //     if (cleanedRow.annual_revenue) {
        //         cleanedRow.annual_revenue = parseInt(cleanedRow.annual_revenue).toLocaleString();
        //     }
        
        //     if (cleanedRow.employees) {
        //         cleanedRow.employees = parseInt(cleanedRow.employees);
        //     }
        
        //     return cleanedRow;
        // });
        // }
        // // Enhanced email generation using all available data
        // // async function generatePersonalizedEmail(lead) {
        // //     // Extract all data fields with fallbacks
        // //     const company = lead.Company || lead.company || '';
        // //     const firstName = lead['First Name'] || lead.first_name || '';
        // //     const lastName = lead['Last Name'] || lead.last_name || '';
        // //     const title = lead.Title || lead.title || '';
        // //     const revenue = lead['Annual Revenue'] || '';
        // //     const website = lead.Website || '';
        // //     const linkedin = lead.LinkedIn || '';
        // //     const sector = lead.Sector || '';
        // //     const employees = lead['# Employees'] || '';
        // //     const city = lead.City || '';
        // //     const state = lead.State || '';
        // //     const email1 = lead['Email-1'] || '';
        // //     const email2 = lead['Email-2'] || '';
        
        // //     // Format location and company details
        // //     const locationText = city && state ? `based in ${city}, ${state}` : '';
        // //     const companySizeText = employees ? `with ${employees} employees` : '';
        
        // //     // Generate more sophisticated subject line
        // //     const subject = `${company}: Strategic ${sector} Industry Partnership Opportunity`;
        
        // //     // Generate detailed personalized email
        // //     const body = `Dear ${firstName}${lastName ? ` ${lastName}` : ''},
        
        // // I hope this email finds you well. I've been following ${company}'s impressive growth in the ${sector} industry${locationText ? ` ${locationText}` : ''}${companySizeText ? ` ${companySizeText}` : ''}.${revenue ? ` Your revenue of ${revenue} demonstrates your market leadership position.` : ''}
        
        // // ${title ? `As ${company}'s ${title}, you're likely focused on strategic growth and operational excellence. ` : ''}Our solutions have helped similar organizations in the ${sector} sector achieve:
        
        // // • 15-25% increase in operational efficiency
        // // • 30% reduction in processing time
        // // • Significant cost savings through automation
        
        // // ${website ? `After reviewing your website (${website}), I've identified several areas where we could potentially add significant value to your operations.` : ''}
        
        // // Would you be interested in a brief call to discuss how we could support ${company}'s continued growth and success?
        
        // // Best regards,
        // // [Sender Name]
        
        // // ${linkedin ? `P.S. I noticed your professional achievements on LinkedIn (${linkedin}) and would welcome connecting there as well.` : ''}`;
        
        // //     // Generate confidence score based on data completeness
        // //     const confidenceScore = calculateConfidenceScore(lead);
        
        // //     // Find all possible phone numbers in the data
        // //     const phoneNumbers = findPhoneNumbers(lead);
        
        // //     return {
        // //         company,
        // //         recipient: `${firstName} ${lastName}`.trim() || 'Unknown Recipient',
        // //         subject,
        // //         body,
        // //         primaryEmail: email1,
        // //         secondaryEmail: email2,
        // //         confidence: confidenceScore,
        // //         phoneNumbers,
        // //         metadata: {
        // //             company: {
        // //                 name: company,
        // //                 revenue,
        // //                 sector,
        // //                 employees,
        // //                 website,
        // //                 location: `${city}${state ? `, ${state}` : ''}`
        // //             },
        // //             contact: {
        // //                 firstName,
        // //                 lastName,
        // //                 title,
        // //                 linkedin,
        // //                 email1,
        // //                 email2
        // //             }
        // //         }
        // //     };
        // // }
        
        // // Helper function to calculate confidence score
        // function calculateConfidenceScore(lead) {
        // const requiredFields = ['Company', 'First Name', 'Last Name', 'Email-1', 'Title'];
        // const optionalFields = ['Website', 'LinkedIn', 'Annual Revenue', 'Sector', '# Employees'];
        
        // let score = 0;
        
        // // Check required fields (60% of score)
        // requiredFields.forEach(field => {
        //     if (lead[field]) score += 12;
        // });
        
        // // Check optional fields (40% of score)
        // optionalFields.forEach(field => {
        //     if (lead[field]) score += 8;
        // });
        
        // return Math.min(score, 100);
        // }
        
        // // Helper function to find phone numbers in data
        // function findPhoneNumbers(lead) {
        // const phoneRegex = /(?:\+?1[-.]?)?\(?([0-9]{3})\)?[-.]?([0-9]{3})[-.]?([0-9]{4})/g;
        // const phones = new Set();
        
        // // Search through all fields for phone numbers
        // Object.values(lead).forEach(value => {
        //     if (typeof value === 'string') {
        //         const matches = value.match(phoneRegex);
        //         if (matches) matches.forEach(phone => phones.add(phone));
        //     }
        // });
        
        // return Array.from(phones);
        // }
        // // Function to clean and map Excel data
        // function cleanExcelData(data) {
        // // Map the empty fields to proper column names based on the screenshot
        // const columnMapping = {
        //     '_empty': 'first_name',
        //     '_empty_1': 'last_name',
        //     '_empty_2': 'title',
        //     '_empty_3': 'email_1',
        //     '_empty_4': 'email_2',
        //     '_empty_5': 'annual_revenue',
        //     '_empty_6': 'website',
        //     '_empty_7': 'linkedin',
        //     '_empty_8': 'notes',
        //     '_empty_9': 'industry',
        //     '_empty_10': 'employees',
        //     '_empty_11': 'city',
        //     '_empty_12': 'state'
        // };
        
        // return data.map(row => {
        //     const cleanedRow = {};
            
        //     // Get the company name from the from/subject field if present
        //     if (row.from) {
        //         const matches = row.from.match(/subject:(.*?):/i);
        //         if (matches && matches[1]) {
        //             cleanedRow.company = matches[1].trim();
        //         }
        //     }
        
        //     // Map each _empty field to its proper column name
        //     Object.entries(columnMapping).forEach(([oldKey, newKey]) => {
        //         if (row[oldKey] !== undefined) {
        //             cleanedRow[newKey] = row[oldKey].toString().trim();
        //         }
        //     });
        
        //     // Format special fields
        //     if (cleanedRow.annual_revenue) {
        //         cleanedRow.annual_revenue = parseInt(cleanedRow.annual_revenue).toLocaleString();
        //     }
        
        //     if (cleanedRow.employees) {
        //         cleanedRow.employees = parseInt(cleanedRow.employees);
        //     }
        
        //     return cleanedRow;
        // });
        // }
        
        // // Enhanced function to create table from Excel data
        
        // // Enhanced table creation
        // function createLeadsTable(data) {
        // try {
        //     if (!data || data.length === 0) {
        //         throw new Error('No valid data to display');
        //     }
        
        //     // Show table and hide skeleton
        //     document.getElementById('leads-skeleton')?.classList.add('hidden');
        //     document.getElementById('leads-table')?.classList.remove('hidden');
        //     document.getElementById('campaign-actions')?.classList.remove('hidden');
        
        //     const tableContainer = document.getElementById('leads-table');
        //     if (!tableContainer) {
        //         throw new Error('Table container not found');
        //     }
        
        //     // Create campaign summary
        //     const campaignControls = document.createElement('div');
        //     campaignControls.className = 'mb-6 p-4 bg-slate-800 rounded-lg';
        //     campaignControls.innerHTML = `
        //         <div class="flex items-center justify-between">
        //             <div class="flex items-center space-x-4">
        //                 <div class="text-sm text-gray-300">
        //                     <span class="font-medium">Total Leads:</span>
        //                     <span class="ml-1">${data.length}</span>
        //                 </div>
        //                 <div class="text-sm text-gray-300">
        //                     <span class="font-medium">Estimated Time:</span>
        //                     <span class="ml-1">${Math.ceil(data.length * 1.5)} minutes</span>
        //                 </div>
        //             </div>
        //             <button id="start-campaign" 
        //                     class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 
        //                            transition-colors flex items-center space-x-2">
        //                 <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        //                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
        //                           d="M13 10V3L4 14h7v7l9-11h-7z"/>
        //                 </svg>
        //                 <span>Start Campaign</span>
        //             </button>
        //         </div>
        //     `;
        
        //     // Create table structure
        //     const columns = [
        //         { key: 'company', label: 'COMPANY' },
        //         { key: 'first_name', label: 'FIRST NAME' },
        //         { key: 'last_name', label: 'LAST NAME' },
        //         { key: 'title', label: 'TITLE' },
        //         { key: 'email_1', label: 'PRIMARY EMAIL' },
        //         { key: 'revenue', label: 'REVENUE' },
        //         { key: 'employees', label: 'EMPLOYEES' },
        //         { key: 'city', label: 'CITY' },
        //         { key: 'state', label: 'STATE' },
        //         { key: 'status', label: 'STATUS' }
        //     ];
        
        //     const table = document.createElement('div');
        //     table.className = 'overflow-x-auto';
        //     table.innerHTML = `
        //         <table class="min-w-full">
        //             <thead>
        //                 <tr class="bg-slate-700">
        //                     ${columns.map(col => `
        //                         <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
        //                             ${col.label}
        //                         </th>
        //                     `).join('')}
        //                 </tr>
        //             </thead>
        //             <tbody class="bg-slate-800 divide-y divide-slate-700">
        //                 ${data.map((row, index) => `
        //                     <tr class="${index % 2 === 0 ? 'bg-slate-800' : 'bg-slate-750'}">
        //                         ${columns.map(col => {
        //                             if (col.key === 'status') {
        //                                 return `
        //                                     <td class="px-6 py-4 whitespace-nowrap status-cell">
        //                                         <span class="px-3 py-1 text-sm rounded-full bg-gray-100 text-gray-800">
        //                                             Pending
        //                                         </span>
        //                                     </td>
        //                                 `;
        //                             }
        //                             return `
        //                                 <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">
        //                                     ${row[col.key] || ''}
        //                                 </td>
        //                             `;
        //                         }).join('')}
        //                     </tr>
        //                 `).join('')}
        //             </tbody>
        //         </table>
        //     `;
        
        //     // Update the container
        //     tableContainer.innerHTML = '';
        //     tableContainer.appendChild(campaignControls);
        //     tableContainer.appendChild(table);
        
        //     // Add campaign start handler
        //     document.getElementById('start-campaign')?.addEventListener('click', function() {
        //         this.disabled = true;
        //         this.innerHTML = `
        //             <div class="flex items-center space-x-2">
        //                 <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
        //                 <span>Processing...</span>
        //             </div>
        //         `;
        //         this.className += ' opacity-75 cursor-not-allowed';
        //         startCampaign(data);
        //     });
        
        // } catch (error) {
        //     console.error('Error creating table:', error);
        //     showError(error.message);
        // }
        // }
        
        // // Error display function
        // function showError(message) {
        // const toast = document.createElement('div');
        // toast.className = `fixed bottom-4 right-4 flex items-center space-x-2 px-6 py-3 
        //                   rounded-lg bg-red-50 border border-red-200 text-red-800 shadow-lg z-50`;
        
        // toast.innerHTML = `
        //     <div class="flex items-center space-x-2">
        //         <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        //             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
        //                   d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        //         </svg>
        //         <span>${message}</span>
        //     </div>
        // `;
        
        // document.body.appendChild(toast);
        // setTimeout(() => {
        //     toast.style.opacity = '0';
        //     toast.style.transform = 'translateY(100%)';
        //     setTimeout(() => toast.remove(), 300);
        // }, 5000);
        // }
        // // Helper function to format revenue values
        // // function formatRevenue(value) {
        // //     if (!value) return '';
        // //     const num = parseFloat(value.toString().replace(/[^0-9.]/g, ''));
        // //     if (isNaN(num)) return value;
        // //     return new Intl.NumberFormat('en-US', {
        // //         style: 'currency',
        // //         currency: 'USD',
        // //         minimumFractionDigits: 0,
        // //         maximumFractionDigits: 0
        // //     }).format(num);
        // // }
        
        // //     function createLeadsTable(data) {
        // //         if (!data || data.length === 0) return;
                
        // //         // Clean the data
        // //         const cleanedData = cleanData(data);
        // //         if (cleanedData.length === 0) return;
        
        // //         // Show table and actions, hide skeleton
        // //         document.getElementById('leads-skeleton').classList.add('hidden');
        // //         document.getElementById('leads-table').classList.remove('hidden');
        // //         document.getElementById('campaign-actions').classList.remove('hidden');
        
        // //         const table = document.createElement('table');
        // //         table.className = 'min-w-full divide-y divide-gray-200 dark:divide-gray-700';
                
        // //         // Create table header
        // //         const thead = document.createElement('thead');
        // //         thead.className = 'bg-gray-50 dark:bg-gray-700 table-fixed-header';
        // //         const headerRow = document.createElement('tr');
                
        // //         // Add checkbox header
        // //         // const checkboxHeader = document.createElement('th');
        // //         // checkboxHeader.className = 'px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-10';
        // //         // const headerCheckbox = document.createElement('input');
        // //         // headerCheckbox.id = 'select-all-checkbox'; // Add this line
        // //         // headerCheckbox.type = 'checkbox';
        // //         // headerCheckbox.className = 'form-checkbox h-4 w-4 text-blue-600 border-gray-300 rounded';
        // //         // headerCheckbox.addEventListener('change', (e) => {
        // //         //     const checkboxes = document.querySelectorAll('.lead-checkbox');
        // //         //     checkboxes.forEach(cb => {
        // //         //         cb.checked = e.target.checked;
        // //         //         const index = parseInt(cb.dataset.index);
        // //         //         if (e.target.checked) {
        // //         //             selectedLeads.add(index);
        // //         //         } else {
        // //         //             selectedLeads.delete(index);
        // //         //         }
        // //         //     });
        // //         //     updateSelectedCount();
        // //         // });
        // //         // checkboxHeader.appendChild(headerCheckbox);
        // //         // headerRow.appendChild(checkboxHeader);
                
        // //         Object.keys(data[0]).forEach(key => {
        // //             const th = document.createElement('th');
        // //             th.className = 'px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider';
        // //             th.textContent = key;
        // //             headerRow.appendChild(th);
        // //         });
                
        // //         thead.appendChild(headerRow);
        // //         table.appendChild(thead);
                
        // //         // Create table body
        // //         const tbody = document.createElement('tbody');
        // //         tbody.className = 'bg-white divide-y divide-gray-200 dark:bg-gray-800 dark:divide-gray-700';
                
        // //         cleanedData.forEach((row, index) => {
        // //             const tr = document.createElement('tr');
        // //             tr.className = index % 2 === 0 ? 'bg-white dark:bg-gray-800' : 'bg-gray-50 dark:bg-gray-700';
                    
        // //             // Add checkbox column
        // //             // const checkboxCell = document.createElement('td');
        // //             // checkboxCell.className = 'px-6 py-4 whitespace-nowrap';
        // //             // const checkbox = document.createElement('input');
        // //             // checkbox.type = 'checkbox';
        // //             // checkbox.className = 'lead-checkbox form-checkbox h-4 w-4 text-blue-600 border-gray-300 rounded';
        // //             // checkbox.dataset.index = index;
        // //             // checkboxCell.appendChild(checkbox);
        // //             // tr.appendChild(checkboxCell);
                    
        // //             Object.values(row).forEach(value => {
        // //                 const td = document.createElement('td');
        // //                 td.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-300';
        // //                 td.textContent = value;
        // //                 tr.appendChild(td);
        // //             });
                    
        // //             tbody.appendChild(tr);
        // //         });
                
        // //         table.appendChild(tbody);
        
        // //             // Create campaign control section
        // // const campaignControls = document.createElement('div');
        // // campaignControls.className = 'my-6 p-6 bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700';
        // // campaignControls.innerHTML = `
        // //     <div class="flex items-center justify-between">
        // //         <div class="flex items-center space-x-4">
        // //             <div class="text-sm text-gray-600 dark:text-gray-400">
        // //                 <span class="font-medium">Total Leads:</span>
        // //                 <span class="ml-1">${cleanedData.length}</span>
        // //             </div>
        // //             <div class="text-sm text-gray-600 dark:text-gray-400">
        // //                 <span class="font-medium">Estimated Time:</span>
        // //                 <span class="ml-1">${Math.ceil(cleanedData.length * 1.5)} minutes</span>
        // //             </div>
        // //         </div>
        // //         <button id="start-campaign" 
        // //                 class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 
        // //                        transition-colors flex items-center space-x-2 font-medium">
        // //             <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        // //                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
        // //                       d="M13 10V3L4 14h7v7l9-11h-7z"/>
        // //             </svg>
        // //             <span>Start Campaign</span>
        // //         </button>
        // //     </div>
        // // `;
        
        // // // Replace existing table content
        // // const tableContainer = document.getElementById('leads-table');
        // // tableContainer.innerHTML = '';
        // // tableContainer.appendChild(campaignControls);
        // // tableContainer.appendChild(table);
        
        // // // Add event listener for campaign start
        // // document.getElementById('start-campaign').addEventListener('click', function() {
        // //     console.log('startCampaig')
        // //     this.disabled = true;
        // //     this.innerHTML = `
        // //         <div class="flex items-center space-x-2">
        // //             <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
        // //             <span>Processing...</span>
        // //         </div>
        // //     `;
        // //     this.className += ' opacity-75 cursor-not-allowed';
        // //     startCampaign(cleanedData);
        // // });
                
        // //         // Replace existing table content
        // //         // const tableContainer = document.getElementById('leads-table');
        // //         // tableContainer.innerHTML = '';
        // //         // tableContainer.appendChild(table);
        
        // //         // Setup checkbox event listeners
        // //         // setupCheckboxListeners();
        // //     }
        
        
        // // Replace the setupCheckboxListeners function with this fixed version
        // function setupCheckboxListeners() {
        // const selectAllBtn = document.getElementById('select-all');
        // const startCampaignBtn = document.getElementById('start-campaign');
        // const headerCheckbox = document.getElementById('select-all-checkbox');
        // const checkboxes = document.querySelectorAll('.lead-checkbox');
        
        // // // Header checkbox functionality
        // headerCheckbox.addEventListener('change', (e) => {
        //     checkboxes.forEach(cb => {
        //         cb.checked = e.target.checked;
        //         const index = parseInt(cb.dataset.index);
        //         if (e.target.checked) {
        //             selectedLeads.add(index);
        //         } else {
        //             selectedLeads.delete(index);
        //         }
        //     });
        //     updateSelectedCount();
        //     selectAllBtn.textContent = e.target.checked ? 'Deselect All' : 'Select All';
        // });
        
        // // Select All button functionality
        // selectAllBtn.addEventListener('click', () => {
        //     const isSelectingAll = selectAllBtn.textContent === 'Select All';
        //     headerCheckbox.checked = isSelectingAll;
        //     checkboxes.forEach(checkbox => {
        //         checkbox.checked = isSelectingAll;
        //         const index = parseInt(checkbox.dataset.index);
        //         if (isSelectingAll) {
        //             selectedLeads.add(index);
        //         } else {
        //             selectedLeads.delete(index);
        //         }
        //     });
        //     updateSelectedCount();
        //     selectAllBtn.textContent = isSelectingAll ? 'Deselect All' : 'Select All';
        // });
        
        // // Individual checkbox functionality
        // checkboxes.forEach(checkbox => {
        //     checkbox.addEventListener('change', (e) => {
        //         const index = parseInt(checkbox.dataset.index);
        //         if (checkbox.checked) {
        //             selectedLeads.add(index);
        //         } else {
        //             selectedLeads.delete(index);
        //             headerCheckbox.checked = false;
        //             selectAllBtn.textContent = 'Select All';
        //         }
        //         updateSelectedCount();
                
        //         // Update header checkbox state
        //         const allChecked = Array.from(checkboxes).every(cb => cb.checked);
        //         headerCheckbox.checked = allChecked;
        //         if (allChecked) {
        //             selectAllBtn.textContent = 'Deselect All';
        //         }
        //     });
        // });
        
        // // Enable/disable start campaign button based on selection
        // function updateStartCampaignButton() {
        //     startCampaignBtn.disabled = selectedLeads.size === 0;
        // }
        
        // // Update selected count and start campaign button state
        // const originalUpdateSelectedCount = window.updateSelectedCount;
        // window.updateSelectedCount = function() {
        //     if (originalUpdateSelectedCount) {
        //         originalUpdateSelectedCount();
        //     }
        //     const selectedCountElement = document.getElementById('selected-count');
        //     if (selectedCountElement) {
        //         selectedCountElement.textContent = `${selectedLeads.size} leads selected`;
        //     }
        //     updateStartCampaignButton();
        // };
        
        // // Initial update of button state
        // updateStartCampaignButton();
        // }
        
        // // Campaign processing states and UI updates
        // const PROCESSING_STATES = {
        // PENDING: 'pending',
        // IN_PROGRESS: 'in_progress',
        // COMPLETED: 'completed',
        // FAILED: 'failed'
        // };
        
        // const TASKS = {
        // EMAIL_GENERATION: 'Generating personalized email',
        // DATA_ENRICHMENT: 'Enriching contact data',
        // LINKEDIN_SCRAPING: 'Collecting LinkedIn information',
        // COMPANY_RESEARCH: 'Researching company details'
        // };
        
        // // Store enriched data for each lead
        // const leadData = new Map();
        
        // // async function startCampaign(leadsData) {
        // //     if (!leadsData) {
        // //         const table = document.querySelector('#leads-table table');
        // //         leadsData = Array.from(table.querySelectorAll('tbody tr')).map(row => {
        // //             const cells = row.querySelectorAll('td');
        // //             const headers = Array.from(table.querySelectorAll('thead th')).map(th => th.textContent);
        // //             const rowData = {};
        // //             cells.forEach((cell, index) => {
        // //                 rowData[headers[index]] = cell.textContent;
        // //             });
        // //             return rowData;
        // //         });
        // //     }
        
        // //     const table = document.querySelector('#leads-table table');
        // //     addStatusColumn(table);
        // //     // Process each selected lead
        // //     for (const [index, lead] of leadsData.entries()) {
        // //         const row = findRowByLeadData(table, lead);
        // //         if (!row) continue;
        
        // //         updateRowStatus(row, PROCESSING_STATES.IN_PROGRESS, TASKS.EMAIL_GENERATION);
            
        // //         try {
        // //             const enrichedData = await processLead(lead, row);
        // //             leadData.set(index, enrichedData);
        // //             updateRowStatus(row, PROCESSING_STATES.COMPLETED, 'Complete');
        // //             addViewButton(row, index);
        // //         } catch (error) {
        // //             console.error('Error processing lead:', error);
        // //             updateRowStatus(row, PROCESSING_STATES.FAILED, error.message);
        // //         }
        // //     }
        
        // //     showCompletionModal(leadsData.length);
        // // }
        
        // async function startCampaign(leadsData) {
        // if (!leadsData || !leadsData.length) {
        //     showError('No leads data provided');
        //     return;
        // }
        
        // const table = document.querySelector('#leads-table table');
        // if (!table) {
        //     showError('Table not found');
        //     return;
        // }
        
        // // Process each lead
        // for (const [index, lead] of leadsData.entries()) {
        //     try {
        //         const row = findRowByLeadData(table, lead);
        //         if (!row) {
        //             console.warn('Row not found for lead:', lead);
        //             continue;
        //         }
        
        //         // Process the lead with basic functionality guaranteed
        //         const enrichedData = await processLead(lead, row);
        //         leadData.set(index, enrichedData);
                
        //         // Update UI
        //         updateRowStatus(row, PROCESSING_STATES.COMPLETED, 'Complete');
        //         addViewButton(row, index);
        //     } catch (error) {
        //         console.error('Error processing lead:', error);
        //         const row = findRowByLeadData(table, lead);
        //         if (row) {
        //             updateRowStatus(row, PROCESSING_STATES.COMPLETED, 'Basic data ready');
        //             addViewButton(row, index);
        //         }
        //     }
        // }
        
        // showCompletionModal(leadsData.length);
        // }
        
        
        // // Update row status with better error handling
        // function updateRowStatus(row, state, task) {
        // if (!row) {
        //     console.error('No row provided for status update');
        //     return;
        // }
        
        // const statusCell = row.querySelector('.status-cell');
        // if (!statusCell) {
        //     console.error('No status cell found in row:', row);
        //     return;
        // }
        
        // const statusClasses = {
        //     [PROCESSING_STATES.PENDING]: 'bg-gray-100 text-gray-600',
        //     [PROCESSING_STATES.IN_PROGRESS]: 'bg-blue-100 text-blue-600',
        //     [PROCESSING_STATES.COMPLETED]: 'bg-green-100 text-green-600',
        //     [PROCESSING_STATES.FAILED]: 'bg-red-100 text-red-600'
        // };
        
        // console.log('Updating status:', { row, state, task });
        
        // statusCell.innerHTML = `
        //     <div class="flex items-center space-x-2 px-4 py-2 rounded-full ${statusClasses[state]}">
        //         ${state === PROCESSING_STATES.IN_PROGRESS ? 
        //             '<div class="animate-spin w-4 h-4 border-2 border-current border-t-transparent rounded-full"></div>' : 
        //             ''
        //         }
        //         <span>${task}</span>
        //     </div>
        // `;
        // }
        
        // // Enhanced add view button function
        // function addViewButton(row, index) {
        // // Remove existing view button if any
        // const existingButton = row.querySelector('.view-button');
        // if (existingButton) {
        //     existingButton.remove();
        // }
        
        // const actionsCell = document.createElement('td');
        // actionsCell.className = 'px-6 py-4 whitespace-nowrap text-right text-sm font-medium';
        // actionsCell.innerHTML = `
        //     <button onclick="showLeadModal(${index})" 
        //             class="view-button text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300">
        //         View Details
        //     </button>
        // `;
        // row.appendChild(actionsCell);
        
        // // Log successful button addition
        // console.log('Added view button to row:', index);
        // }
        // // async function processLead(lead, row) {
        
        
        // //     // Simulate email generation
        // //     updateRowStatus(row, PROCESSING_STATES.IN_PROGRESS, TASKS.EMAIL_GENERATION);
        // //     const emailData = await generatePersonalizedEmail(lead);
        // //     await simulateDelay();
        
        // //     // Simulate data enrichment
        // //     updateRowStatus(row, PROCESSING_STATES.IN_PROGRESS, TASKS.DATA_ENRICHMENT);
        // //     const enrichedContacts = await enrichContactData(lead);
        // //     await simulateDelay();
        
        // //     // Simulate LinkedIn scraping
        // //     updateRowStatus(row, PROCESSING_STATES.IN_PROGRESS, TASKS.LINKEDIN_SCRAPING);
        // //     const linkedinData = await scrapeLinkedInData(lead);
        // //     await simulateDelay();
        
        // //     // Simulate company research
        // //     updateRowStatus(row, PROCESSING_STATES.IN_PROGRESS, TASKS.COMPANY_RESEARCH);
        // //     const companyData = await researchCompany(lead);
        // //     await simulateDelay();
        
        // //     return {
        // //         lead,
        // //         emailData,
        // //         enrichedContacts,
        // //         linkedinData,
        // //         companyData
        // //     };
        // // }
        
        
        // // Real data processing functions to replace simulations
        
        // async function processWebsiteData(url) {
        // try {
        //     const response = await fetch(`http://localhost:4000/scrape?url=${encodeURIComponent(url)}`);
        //     if (!response.ok) throw new Error('Failed to scrape website');
        //     const data = await response.json();
            
        //     return data;
        // } catch (error) {
        //     console.error('Error scraping website:', error);
        //     throw error;
        // }
        // }
        
        // async function validateEmail(email) {
        // try {
        //     const response = await fetch(`/api/validate-email`, {
        //         method: 'POST',
        //         headers: {
        //             'Content-Type': 'application/json'
        //         },
        //         body: JSON.stringify({ email })
        //     });
        //     if (!response.ok) throw new Error('Failed to validate email');
        //     const data = await response.json();
        //     return {
        //         isValid: data.result.score > 0.5,
        //         confidence: Math.round(data.result.score * 100),
        //         details: data.result
        //     };
        // } catch (error) {
        //     console.error('Error validating email:', error);
        //     return {
        //         isValid: false,
        //         confidence: 0,
        //         details: { error: error.message }
        //     };
        // }
        // }
        
        
        // async function processLead(lead, row) {
        // try {
        //     // Update status to processing
        //     updateRowStatus(row, PROCESSING_STATES.IN_PROGRESS, 'Processing lead data');
        
        //     // Base metadata that will always work
        //     const metadata = {
        //         company: {
        //             name: lead.company || '',
        //             revenue: lead.revenue || '',
        //             employees: lead.employees || '',
        //             location: `${lead.city || ''}, ${lead.state || ''}`,
        //             industry: lead.industry || 'Medical Device Manufacturing',
        //             website: lead.website || ''
        //         },
        //         contact: {
        //             firstName: lead.first_name || '',
        //             lastName: lead.last_name || '',
        //             title: lead.title || '',
        //             email: lead.email_1 || '',
        //             email2: lead.email_2 || '',
        //             linkedin: lead.linkedin || ''
        //         }
        //     };
        
        //     // Try to get enhanced data but don't fail if it doesn't work
        //     let websiteData = null;
        //     let emailValidation = null;
        
        //     if (lead.website) {
        //         try {
        //             updateRowStatus(row, PROCESSING_STATES.IN_PROGRESS, 'Scraping website data');
        //             websiteData = await processWebsiteData(lead.website);
        //             console.log(websiteData)
        //         } catch (error) {
        //             console.warn('Website scraping failed:', error);
        //             // Continue without website data
        //         }
        //     }
        
        //     if (lead.email_1) {
        //         try {
        //             updateRowStatus(row, PROCESSING_STATES.IN_PROGRESS, 'Validating email');
        //             emailValidation = await validateEmail(lead.email_1);
        //         } catch (error) {
        //             console.warn('Email validation failed:', error);
        //             // Continue without email validation
        //         }
        //     }
        
        //     // Generate email content with available data
        //     updateRowStatus(row, PROCESSING_STATES.IN_PROGRESS, 'Generating email');
        //     const emailData = generateBasicEmail(metadata, websiteData);
        
        //     // Always return data object with fallbacks
        //     return {
        //         lead,
        //         emailData,
        //         websiteData: websiteData || {
        //             data: {
        //                 business: {
        //                     categories: { industries: ['Medical Device Manufacturing'] }
        //                 }
        //             }
        //         },
        //         emailValidation: emailValidation || {
        //             isValid: true,
        //             confidence: 70,
        //             details: { info: 'Basic validation only' }
        //         },
        //         metadata
        //     };
        
        // } catch (error) {
        //     console.error('Error in processLead:', error);
        //     // Return basic data even if something fails
        //     return {
        //         lead,
        //         emailData: generateBasicEmail({
        //             company: { name: lead.company },
        //             contact: { 
        //                 firstName: lead.first_name,
        //                 lastName: lead.last_name,
        //                 title: lead.title,
        //                 email: lead.email_1
        //             }
        //         }),
        //         metadata: {
        //             company: { name: lead.company },
        //             contact: { 
        //                 firstName: lead.first_name,
        //                 lastName: lead.last_name
        //             }
        //         }
        //     };
        // }
        // }
        
        // function generateBasicEmail(metadata, websiteData = null) {
        // const { company, contact } = metadata;
        
        // // Generate subject line using company details
        // const subject = `Strategic Medical Device Manufacturing Partnership - ${company.name}`;
        
        // // Build personalized intro based on available data
        // const intro = `Dear ${contact.firstName}${contact.lastName ? ` ${contact.lastName}` : ''},
        
        // I hope this email finds you well. I noticed ${company.name}'s impressive work in the medical device manufacturing industry${
        // company.revenue ? ` with annual revenue of ${company.revenue}` : ''
        // }${company.location ? `, based in ${company.location}` : ''}.`;
        
        // // Build value proposition based on company size
        // const valueProposition = company.employees && parseInt(company.employees) > 0 ? 
        //     `\n\nWith your team of ${company.employees} employees, I understand the complexity of managing large-scale medical device manufacturing operations.` :
        //     `\n\nAs a growing medical device manufacturer, I understand the challenges of scaling operations while maintaining quality and compliance.`;
        
        // // Add specific details from website scraping if available
        // const websiteInsights = websiteData?.data?.business?.categories?.industries ? 
        //     `\n\nYour focus on ${websiteData.data.business.categories.industries.join(', ')} aligns perfectly with our expertise.` : '';
        
        // // Build the complete email body
        // const body = `${intro}${valueProposition}${websiteInsights}
        
        // Our team specializes in helping medical device manufacturers:
        // • Optimize manufacturing processes while maintaining FDA compliance
        // • Reduce time-to-market for new devices
        // • Implement quality management systems that exceed industry standards
        // • Scale operations efficiently while maintaining margins
        
        // Would you be open to a brief call to discuss how we could support ${company.name}'s continued growth and success in the medical device market?
        
        // Best regards,
        // [Sender Name]${contact.linkedin ? `\n\nP.S. I'd welcome connecting on LinkedIn as well: ${contact.linkedin}` : ''}`;
        
        // return {
        //     subject,
        //     body,
        //     metadata,
        //     confidence: calculateBasicConfidence(metadata)
        // };
        // }
        
        // function calculateBasicConfidence(metadata) {
        // let score = 50; // Start with base score
        
        // // Add points for available data
        // if (metadata.company.name) score += 10;
        // if (metadata.contact.firstName) score += 10;
        // if (metadata.contact.lastName) score += 10;
        // if (metadata.contact.email) score += 10;
        // if (metadata.company.revenue) score += 5;
        // if (metadata.company.employees) score += 5;
        
        // return Math.min(score, 100);
        // }
        
        // // Enhanced processLead function
        // // async function processLead(lead, row) {
        // //     try {
        // //         console.log("processign lead : ", lead)
        // //         // Extract website from lead data
        // //         const website = lead.website || lead.Website || '';
            
        // //         // Update status for website scraping
        // //         updateRowStatus(row, PROCESSING_STATES.IN_PROGRESS, 'Scraping website data');
        // //         const websiteData = website ? await processWebsiteData(website) : null;
        
        // //         // Validate email
        // //         updateRowStatus(row, PROCESSING_STATES.IN_PROGRESS, 'Validating email');
        // //         const email = lead.email || lead['Email-1'] || '';
        // //         const emailValidation = email ? await validateEmail(email) : null;
        
        // //         // Generate personalized email with enhanced data
        // //         updateRowStatus(row, PROCESSING_STATES.IN_PROGRESS, 'Generating email');
        // //         const emailData = await generatePersonalizedEmail(lead, websiteData, emailValidation);
        
        // //         return {
        // //             lead,
        // //             emailData,
        // //             websiteData,
        // //             emailValidation
        // //         };
        // //     } catch (error) {
        // //         console.error('Error processing lead:', error);
        // //         throw error;
        // //     }
        // // }
        
        // // Enhanced email generation with website data
        // // async function generatePersonalizedEmail(lead, websiteData, emailValidation) {
        // //     const companyName = lead.Company || lead.company || '';
        // //     const firstName = lead['First Name'] || lead.first_name || '';
        // //     const lastName = lead['Last Name'] || lead.last_name || '';
        
        // //     // Extract relevant data from website scraping
        // //     const companyInfo = websiteData?.data?.business || {};
        // //     const categories = companyInfo.categories || {};
        // //     const metrics = companyInfo.metrics || {};
        // //     const peopleInfo = websiteData?.data?.people || {};
        
        // //     // Build enhanced metadata
        // //     const metadata = {
        // //         company: {
        // //             name: companyName,
        // //             website: lead.website || '',
        // //             industry: categories.industries ? Object.keys(categories.industries).join(', ') : '',
        // //             size: metrics.companySize || 'Unknown',
        // //             revenue: metrics.revenue || 'Unknown',
        // //             age: metrics.age ? `${metrics.age} years` : 'Unknown'
        // //         },
        // //         contact: {
        // //             firstName,
        // //             lastName,
        // //             title: lead.Title || lead.title || '',
        // //             email: lead['Email-1'] || '',
        // //             emailValidation: emailValidation || {},
        // //             phone: peopleInfo.phones?.length > 0 ? peopleInfo.phones[0] : '',
        // //             social: peopleInfo.social || {}
        // //         }
        // //     };
        
        // //     // Generate more targeted subject line based on company info
        // //     const subject = `Strategic Partnership Opportunity - ${companyName} ${
        // //         categories.industries ? `(${Object.keys(categories.industries)[0]})` : ''
        // //     }`;
        
        // //     // Generate enhanced email body using all available data
        // //     const body = `Dear ${firstName}${lastName ? ` ${lastName}` : ''},
        
        // // I hope this email finds you well. I noticed ${companyName}'s impressive work${
        // //     categories.industries ? ` in the ${Object.keys(categories.industries).join(' and ')} industry` : ''
        // // }${metrics.age ? `, with ${metrics.age} years of established excellence` : ''}.
        
        // // ${websiteData?.data?.business?.features ? 
        // //     `Your focus on ${Object.keys(websiteData.data.business.features).join(', ')} particularly caught my attention.` : ''
        // // }
        
        // // Would you be interested in exploring how we could support your continued growth and success? I'd welcome the opportunity to discuss this further.
        
        // // Best regards,
        // // [Sender Name]`;
        
        // //     return {
        // //         subject,
        // //         body,
        // //         metadata,
        // //         confidence: emailValidation?.confidence || 0
        // //     };
        // // }
        
        
        // async function generatePersonalizedEmail(metadata, websiteData) {
        // const { company, contact } = metadata;
        
        // // Generate subject line using company details
        // const subject = `Strategic Medical Device Manufacturing Partnership - ${company.name}`;
        
        // // Build personalized intro based on available data
        // const intro = `Dear ${contact.firstName}${contact.lastName ? ` ${contact.lastName}` : ''},
        
        // I hope this email finds you well. I noticed ${company.name}'s impressive work in the medical device manufacturing industry${
        // company.revenue ? ` with annual revenue of $${company.revenue}` : ''
        // }${company.location ? `, based in ${company.location}` : ''}.`;
        
        // // Build value proposition based on company size
        // const valueProposition = company.employees > 200 ? 
        //     `\n\nWith your team of ${company.employees} employees, I understand the complexity of managing large-scale medical device manufacturing operations.` :
        //     `\n\nAs a growing medical device manufacturer, I understand the challenges of scaling operations while maintaining quality and compliance.`;
        
        // // Add specific details from website scraping if available
        // const websiteInsights = websiteData?.data?.business?.categories?.industries ? 
        //     `\n\nYour focus on ${Object.keys(websiteData.data.business.categories.industries).join(', ')} aligns perfectly with our expertise.` : '';
        
        // // Build the complete email body
        // const body = `${intro}${valueProposition}${websiteInsights}
        
        // Our team specializes in helping medical device manufacturers:
        // • Optimize manufacturing processes while maintaining FDA compliance
        // • Reduce time-to-market for new devices
        // • Implement quality management systems that exceed industry standards
        // • Scale operations efficiently while maintaining margins
        
        // Would you be open to a brief call to discuss how we could support ${company.name}'s continued growth and success in the medical device market?
        
        // Best regards,
        // [Sender Name]${contact.linkedin ? `\n\nP.S. I'd welcome connecting on LinkedIn as well: ${contact.linkedin}` : ''}`;
        
        // return {
        //     subject,
        //     body,
        //     metadata,
        //     confidence: calculateEmailConfidence(metadata)
        // };
        // }
        
        // function calculateEmailConfidence(metadata) {
        // let score = 0;
        
        // // Company information quality
        // if (metadata.company.name) score += 15;
        // if (metadata.company.revenue) score += 10;
        // if (metadata.company.employees) score += 10;
        // if (metadata.company.website) score += 10;
        // if (metadata.company.location) score += 5;
        
        // // Contact information quality
        // if (metadata.contact.firstName) score += 10;
        // if (metadata.contact.lastName) score += 10;
        // if (metadata.contact.title) score += 10;
        // if (metadata.contact.email) score += 10;
        // if (metadata.contact.linkedin) score += 10;
        
        // return Math.min(score, 100);
        // }
        // // 
        // // 
        // // 
        // // 
        
        
        // // 
        // // 
        // // Enhanced modal content display
        // function createWebsiteDataSection(websiteData) {
        // if (!websiteData) return '';
        
        // const { business, technical, people } = websiteData.data || {};
        
        // return `
        //     <!-- Website Analysis -->
        //     <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mt-4">
        //         <h4 class="font-medium mb-3 text-gray-900 dark:text-white flex items-center">
        //             <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        //                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
        //                       d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/>
        //             </svg>
        //             Website Analysis
        //         </h4>
                
        //         ${business ? `
        //             <div class="mb-4">
        //                 <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Business Details</h5>
        //                 <div class="grid grid-cols-2 gap-2 text-sm">
        //                     ${business.categories?.industries ? `
        //                         <div>
        //                             <span class="font-medium">Industries:</span>
        //                             <span class="text-gray-600 dark:text-gray-400">
        //                                 ${Object.keys(business.categories.industries).join(', ')}
        //                             </span>
        //                         </div>
        //                     ` : ''}
        //                     ${business.metrics?.companyAge ? `
        //                         <div>
        //                             <span class="font-medium">Company Age:</span>
        //                             <span class="text-gray-600 dark:text-gray-400">
        //                                 ${business.metrics.companyAge} years
        //                             </span>
        //                         </div>
        //                     ` : ''}
        //                 </div>
        //             </div>
        //         ` : ''}
                
        //         ${people ? `
        //             <div class="mb-4">
        //                 <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Contact Information</h5>
        //                 ${people.phones?.length ? `
        //                     <div class="mb-2">
        //                         <span class="font-medium">Phone Numbers:</span>
        //                         ${people.phones.map(phone => `
        //                             <div class="flex items-center justify-between">
        //                                 <span class="text-gray-600 dark:text-gray-400">${phone}</span>
        //                                 <button onclick="copyToClipboard('${phone}')" 
        //                                         class="text-blue-600 hover:text-blue-800 dark:text-blue-400">
        //                                     Copy
        //                                 </button>
        //                             </div>
        //                         `).join('')}
        //                     </div>
        //                 ` : ''}
        //                 ${people.emails?.length ? `
        //                     <div>
        //                         <span class="font-medium">Emails:</span>
        //                         ${people.emails.map(email => `
        //                             <div class="flex items-center justify-between">
        //                                 <span class="text-gray-600 dark:text-gray-400">${email}</span>
        //                                 <button onclick="copyToClipboard('${email}')" 
        //                                         class="text-blue-600 hover:text-blue-800 dark:text-blue-400">
        //                                     Copy
        //                                 </button>
        //                             </div>
        //                         `).join('')}
        //                     </div>
        //                 ` : ''}
        //             </div>
        //         ` : ''}
        //     </div>
        // `;
        // }
        
        
        // // function addViewButton(row, index) {
        // //     const actionsCell = document.createElement('td');
        // //     actionsCell.className = 'px-6 py-4 whitespace-nowrap text-right text-sm font-medium';
        // //     actionsCell.innerHTML = `
        // //         <button onclick="showLeadModal(${index})" 
        // //                 class="text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300">
        // //             View Details
        // //         </button>
        // //     `;
        // //     row.appendChild(actionsCell);
        // // }
        
        // // function showLeadModal(index) {
        // //     const data = leadData.get(index);
        // //     if (!data) return;
        
        // //     const modal = document.createElement('div');
        // //     modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
        // //     modal.innerHTML = `
        // //         <div class="relative w-11/12 max-w-5xl max-h-[90vh] bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden">
        // //             <!-- Header -->
        // //             <div class="flex items-center justify-between px-6 py-4 border-b dark:border-gray-700">
        // //                 <div class="flex items-center space-x-4">
        // //                     <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
        // //                         ${data.emailData.company}
        // //                     </h3>
        // //                     <span class="px-3 py-1 text-sm rounded-full ${
        // //                         data.emailData.confidence >= 80 ? 'bg-green-100 text-green-800' :
        // //                         data.emailData.confidence >= 60 ? 'bg-yellow-100 text-yellow-800' :
        // //                         'bg-red-100 text-red-800'
        // //                     }">
        // //                         ${data.emailData.confidence}% Confidence
        // //                     </span>
        // //                 </div>
        // //                 <button onclick="this.closest('.fixed').remove()" 
        // //                         class="text-gray-400 hover:text-gray-500 dark:hover:text-gray-300">
        // //                     <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        // //                         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        // //                     </svg>
        // //                 </button>
        // //             </div>
        
        // //             <!-- Content -->
        // //             <div class="overflow-y-auto p-6" style="max-height: calc(90vh - 130px);">
        // //                 <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        // //                     <!-- Left Column: Company & Contact Info -->
        // //                     <div class="space-y-6">
        // //                         <!-- Company Card -->
        // //                         <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
        // //                             <h4 class="font-medium mb-3 text-gray-900 dark:text-white flex items-center">
        // //                                 <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        // //                                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
        // //                                           d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
        // //                                 </svg>
        // //                                 Company Details
        // //                             </h4>
        // //                             ${Object.entries(data.emailData.metadata.company)
        // //                                 .map(([key, value]) => `
        // //                                     <div class="text-sm mb-2">
        // //                                         <span class="font-medium text-gray-700 dark:text-gray-300">${
        // //                                             key.charAt(0).toUpperCase() + key.slice(1)
        // //                                         }:</span> 
        // //                                         <span class="text-gray-600 dark:text-gray-400">${value || 'N/A'}</span>
        // //                                     </div>
        // //                                 `).join('')}
        // //                         </div>
        
        // //                         <!-- Contact Card -->
        // //                         <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
        // //                             <h4 class="font-medium mb-3 text-gray-900 dark:text-white flex items-center">
        // //                                 <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        // //                                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
        // //                                           d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
        // //                                 </svg>
        // //                                 Contact Information
        // //                             </h4>
        // //                             ${Object.entries(data.emailData.metadata.contact)
        // //                                 .map(([key, value]) => `
        // //                                     <div class="text-sm mb-2">
        // //                                         <span class="font-medium text-gray-700 dark:text-gray-300">${
        // //                                             key.charAt(0).toUpperCase() + key.slice(1)
        // //                                         }:</span> 
        // //                                         <span class="text-gray-600 dark:text-gray-400">${value || 'N/A'}</span>
        // //                                     </div>
        // //                                 `).join('')}
        // //                         </div>
        
        // //                         <!-- Phone Numbers -->
        // //                         <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
        // //                             <h4 class="font-medium mb-3 text-gray-900 dark:text-white flex items-center">
        // //                                 <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        // //                                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
        // //                                           d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
        // //                                 </svg>
        // //                                 Phone Numbers
        // //                             </h4>
        // //                             ${data.emailData.phoneNumbers.length > 0 ? 
        // //                                 data.emailData.phoneNumbers.map(phone => `
        // //                                     <div class="text-sm mb-2 flex items-center justify-between">
        // //                                         <span class="text-gray-600 dark:text-gray-400">${phone}</span>
        // //                                         <button onclick="copyToClipboard('${phone}')" 
        // //                                                 class="text-blue-600 hover:text-blue-800 dark:text-blue-400">
        // //                                             Copy
        // //                                         </button>
        // //                                     </div>
        // //                                 `).join('') : 
        // //                                 '<div class="text-sm text-gray-500">No phone numbers found</div>'
        // //                             }
        // //                         </div>
        // //                     </div>
        
        // //                     <!-- Right Column: Email Preview & Actions -->
        // //                     <div class="md:col-span-2 space-y-6">
        // //                         <!-- Email Preview -->
        // //                         <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
        // //                             <h4 class="font-medium mb-3 text-gray-900 dark:text-white flex items-center">
        // //                                 <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        // //                                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
        // //                                           d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
        // //                                 </svg>
        // //                                 Generated Email
        // //                             </h4>
        // //                             <div class="prose dark:prose-invert max-w-none">
        // //                                 <div class="text-sm space-y-3">
        // //                                     <div class="font-medium text-gray-900 dark:text-white">
        // //                                         Subject: ${data.emailData.subject}
        // //                                     </div>
        // //                                     <div class="whitespace-pre-line text-gray-600 dark:text-gray-400">
        // //                                         ${data.emailData.body}
        // //                                     </div>
        // //                                 </div>
        // //                             </div>
        // //                         </div>
        
        // //                         <!-- Action Buttons -->
        // //                         <div class="flex flex-wrap gap-4">
        // //                             <!-- Primary Actions -->
        // //                             <button onclick="sendEmail(${index}, '${data.emailData.primaryEmail}')"
        // //                                     class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 
        // //                                            transition-colors flex items-center justify-center space-x-2 min-w-[120px]">
        // //                                 <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        // //                                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
        // //                                           d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
        // //                                 </svg>
        // //                                 <span>Send Email</span>
        // //                             </button>
        // // <button onclick="copyEmailContent(${index})"
        // //                                     class="flex-1 px-4 py-2 bg-gray-100 text-gray-800 rounded-lg hover:bg-gray-200 
        // //                                            transition-colors flex items-center justify-center space-x-2 min-w-[120px]">
        // //                                 <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        // //                                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
        // //                                           d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"/>
        // //                                 </svg>
        // //                                 <span>Copy Email</span>
        // //                             </button>
        
        // //                             <button onclick="exportLeadData(${index})"
        // //                                     class="flex-1 px-4 py-2 bg-gray-100 text-gray-800 rounded-lg hover:bg-gray-200 
        // //                                            transition-colors flex items-center justify-center space-x-2 min-w-[120px]">
        // //                                 <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        // //                                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
        // //                                           d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
        // //                                 </svg>
        // //                                 <span>Export Data</span>
        // //                             </button>
        // //                         </div>
        // //                     </div>
        // //                 </div>
        // //             </div>
        // //         </div>
        // //     `;
        
        // //     document.body.appendChild(modal);
        // // }
        
        // // Function to send email via SMTP
        // function showLeadModal(index) {
        // const data = leadData.get(index);
        // if (!data) return;
        
        // const modal = document.createElement('div');
        // modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
        // modal.innerHTML = `
        //     <div class="relative w-11/12 max-w-5xl max-h-[90vh] bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden">
        //         <!-- Header -->
        //         <div class="flex items-center justify-between px-6 py-4 border-b dark:border-gray-700">
        //             <div class="flex items-center space-x-4">
        //                 <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
        //                     ${data.emailData.metadata.company.name}
        //                 </h3>
        //                 <div class="flex space-x-2">
        //                     ${data.emailValidation ? `
        //                         <span class="px-3 py-1 text-sm rounded-full ${
        //                             data.emailValidation.confidence >= 80 ? 'bg-green-100 text-green-800' :
        //                             data.emailValidation.confidence >= 60 ? 'bg-yellow-100 text-yellow-800' :
        //                             'bg-red-100 text-red-800'
        //                         }">
        //                             Email Confidence: ${data.emailValidation.confidence}%
        //                         </span>
        //                     ` : ''}
        //                     <span class="px-3 py-1 text-sm rounded-full ${
        //                         data.emailData.confidence >= 80 ? 'bg-green-100 text-green-800' :
        //                         data.emailData.confidence >= 60 ? 'bg-yellow-100 text-yellow-800' :
        //                         'bg-red-100 text-red-800'
        //                     }">
        //                         Lead Quality: ${data.emailData.confidence}%
        //                     </span>
        //                 </div>
        //             </div>
        //             <button onclick="this.closest('.fixed').remove()" 
        //                     class="text-gray-400 hover:text-gray-500 dark:hover:text-gray-300">
        //                 <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        //                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        //                 </svg>
        //             </button>
        //         </div>
        
        //         <!-- Content -->
        //         <div class="overflow-y-auto p-6" style="max-height: calc(90vh - 130px);">
        //             <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        //                 <!-- Left Column: Company & Contact Info -->
        //                 <div class="space-y-6">
        //                     <!-- Company Card -->
        //                     <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
        //                         <h4 class="font-medium mb-3 text-gray-900 dark:text-white flex items-center">
        //                             <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        //                                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
        //                                       d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
        //                             </svg>
        //                             Company Details
        //                         </h4>
        //                         ${Object.entries(data.emailData.metadata.company)
        //                             .map(([key, value]) => value ? `
        //                                 <div class="text-sm mb-2">
        //                                     <span class="font-medium text-gray-700 dark:text-gray-300">${
        //                                         key.charAt(0).toUpperCase() + key.slice(1)
        //                                     }:</span> 
        //                                     <span class="text-gray-600 dark:text-gray-400">${value}</span>
        //                                 </div>
        //                             ` : '').join('')}
        //                     </div>
        
        //                     <!-- Contact Card -->
        //                     <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
        //                         <h4 class="font-medium mb-3 text-gray-900 dark:text-white flex items-center">
        //                             <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        //                                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
        //                                       d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
        //                             </svg>
        //                             Contact Information
        //                         </h4>
        //                         ${Object.entries(data.emailData.metadata.contact)
        //                             .filter(([key, value]) => value && key !== 'emailValidation' && key !== 'social')
        //                             .map(([key, value]) => `
        //                                 <div class="text-sm mb-2">
        //                                     <span class="font-medium text-gray-700 dark:text-gray-300">${
        //                                         key.charAt(0).toUpperCase() + key.slice(1)
        //                                     }:</span> 
        //                                     <span class="text-gray-600 dark:text-gray-400">${value}</span>
        //                                 </div>
        //                             `).join('')}
                                
        //                         ${data.emailData.metadata.contact.social ? `
        //                             <div class="mt-3">
        //                                 <span class="font-medium text-gray-700 dark:text-gray-300">Social Links:</span>
        //                                 <div class="flex space-x-2 mt-1">
        //                                     ${Object.entries(data.emailData.metadata.contact.social)
        //                                         .filter(([_, value]) => value)
        //                                         .map(([platform, value]) => `
        //                                             <a href="${value}" target="_blank" 
        //                                                class="text-blue-600 hover:text-blue-800 dark:text-blue-400">
        //                                                 ${platform}
        //                                             </a>
        //                                         `).join('')}
        //                                 </div>
        //                             </div>
        //                         ` : ''}
        //                     </div>
        
        //                     <!-- Website Data -->
        //                     ${data.websiteData ? `
        //                         <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
        //                             <h4 class="font-medium mb-3 text-gray-900 dark:text-white flex items-center">
        //                                 <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        //                                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
        //                                           d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/>
        //                                 </svg>
        //                                 Website Analysis
        //                             </h4>
                                    
        //                             ${data.websiteData.data.business ? `
        //                                 <div class="mb-4">
        //                                     <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
        //                                         Business Details
        //                                     </h5>
        //                                     <div class="grid grid-cols-2 gap-2 text-sm">
        //                                         ${data.websiteData.data.business.categories?.industries ? `
        //                                             <div>
        //                                                 <span class="font-medium">Industries:</span>
        //                                                 <span class="text-gray-600 dark:text-gray-400">
        //                                                     ${Object.keys(data.websiteData.data.business.categories.industries).join(', ')}
        //                                                 </span>
        //                                             </div>
        //                                         ` : ''}
        //                                         ${data.websiteData.data.business.metrics?.companyAge ? `
        //                                             <div>
        //                                                 <span class="font-medium">Company Age:</span>
        //                                                 <span class="text-gray-600 dark:text-gray-400">
        //                                                     ${data.websiteData.data.business.metrics.companyAge} years
        //                                                 </span>
        //                                             </div>
        //                                         ` : ''}
        //                                     </div>
        //                                 </div>
        //                             ` : ''}
                                    
        //                             ${data.websiteData.data.people?.phones?.length ? `
        //                                 <div class="mb-4">
        //                                     <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
        //                                         Found Phone Numbers
        //                                     </h5>
        //                                     ${data.websiteData.data.people.phones.map(phone => `
        //                                         <div class="flex items-center justify-between text-sm mb-1">
        //                                             <span class="text-gray-600 dark:text-gray-400">${phone}</span>
        //                                             <button onclick="copyToClipboard('${phone}')" 
        //                                                     class="text-blue-600 hover:text-blue-800 dark:text-blue-400">
        //                                                 Copy
        //                                             </button>
        //                                         </div>
        //                                     `).join('')}
        //                                 </div>
        //                             ` : ''}
        //                         </div>
        //                     ` : ''}
        //                 </div>
        
        //                 <!-- Right Column: Email Preview & Actions -->
        //                 <div class="md:col-span-2 space-y-6">
        //                     <!-- Email Preview -->
        //                     <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
        //                         <h4 class="font-medium mb-3 text-gray-900 dark:text-white flex items-center">
        //                             <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        //                                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
        //                                       d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
        //                             </svg>
        //                             Generated Email
        //                         </h4>
        //                         <div class="prose dark:prose-invert max-w-none">
        //                             <div class="text-sm space-y-3">
        //                                 <div class="font-medium text-gray-900 dark:text-white">
        //                                     Subject: ${data.emailData.subject}
        //                                 </div>
        //                                 <div class="whitespace-pre-line text-gray-600 dark:text-gray-400">
        //                                     ${data.emailData.body}
        //                                 </div>
        //                             </div>
        //                         </div>
        //                     </div>
        
        //                     <!-- Action Buttons -->
        //                     <div class="flex flex-wrap gap-4">
        //                         <button onclick="sendEmail(${index}, '${data.emailData.metadata.contact.email}')"
        //                                 class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 
        //                                        transition-colors flex items-center justify-center space-x-2 min-w-[120px]">
        //                             <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        //                                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
        //                                       d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
        //                             </svg>
        //                             <span>Send Email</span>
        //                         </button>
        //                         <button onclick="copyEmailContent(${index})"
        //                                 class="flex-1 px-4 py-2 bg-gray-100 text-gray-800 rounded-lg hover:bg-gray-200 
        //                                        transition-colors flex items-center justify-center space-x-2 min-w-[120px]">
        //                             <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        //                                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
        //                                       d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"/>
        //                             </svg>
        //                             <span>Copy Email</span>
        //                         </button>
        //                         <button onclick="exportLeadData(${index})"
        //                                 class="flex-1 px-4 py-2 bg-gray-100 text-gray-800 rounded-lg hover:bg-gray-200 
        //                                        transition-colors flex items-center justify-center space-x-2 min-w-[120px]">
        //                             <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        //                                 <path stroke-linecap="round" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
        //                                       d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
        //                             </svg>
        //                             <span>Export Data</span>
        //                         </button>
        //                     </div>
        
        //                     <!-- Email Validation Details -->
        //                     ${data.emailValidation ? `
        //                         <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
        //                             <h4 class="font-medium mb-3 text-gray-900 dark:text-white flex items-center">
        //                                 <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        //                                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
        //                                           d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
        //                                 </svg>
        //                                 Email Validation Results
        //                             </h4>
        //                             <div class="grid grid-cols-2 gap-4 text-sm">
        //                                 <div>
        //                                     <span class="font-medium text-gray-700 dark:text-gray-300">Status:</span>
        //                                     <span class="ml-2 ${
        //                                         data.emailValidation.isValid ? 'text-green-600' : 'text-red-600'
        //                                     }">
        //                                         ${data.emailValidation.isValid ? 'Valid' : 'Invalid'}
        //                                     </span>
        //                                 </div>
        //                                 <div>
        //                                     <span class="font-medium text-gray-700 dark:text-gray-300">Confidence:</span>
        //                                     <span class="ml-2 text-gray-600 dark:text-gray-400">
        //                                         ${data.emailValidation.confidence}%
        //                                     </span>
        //                                 </div>
        //                                 ${data.emailValidation.details ? Object.entries(data.emailValidation.details)
        //                                     .filter(([key, value]) => key !== 'score' && value !== null)
        //                                     .map(([key, value]) => `
        //                                         <div class="col-span-2">
        //                                             <span class="font-medium text-gray-700 dark:text-gray-300">
        //                                                 ${key.charAt(0).toUpperCase() + key.slice(1)}:
        //                                             </span>
        //                                             <span class="ml-2 text-gray-600 dark:text-gray-400">
        //                                                 ${typeof value === 'boolean' ? (value ? 'Yes' : 'No') : value}
        //                                             </span>
        //                                         </div>
        //                                     `).join('') : ''}
        //                             </div>
        //                         </div>
        //                     ` : ''}
        
        //                     <!-- Additional Data from Website -->
        //                     ${data.websiteData?.data?.technical ? `
        //                         <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
        //                             <h4 class="font-medium mb-3 text-gray-900 dark:text-white flex items-center">
        //                                 <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        //                                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
        //                                           d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
        //                                 </svg>
        //                                 Technical Stack
        //                             </h4>
        //                             <div class="grid grid-cols-2 gap-4 text-sm">
        //                                 ${Object.entries(data.websiteData.data.technical.stack)
        //                                     .filter(([_, value]) => value && value.length > 0)
        //                                     .map(([category, tools]) => `
        //                                         <div class="col-span-2">
        //                                             <span class="font-medium text-gray-700 dark:text-gray-300">
        //                                                 ${category.charAt(0).toUpperCase() + category.slice(1)}:
        //                                             </span>
        //                                             <span class="ml-2 text-gray-600 dark:text-gray-400">
        //                                                 ${tools.join(', ')}
        //                                             </span>
        //                                         </div>
        //                                     `).join('')}
        //                             </div>
        //                         </div>
        //                     ` : ''}
        //                 </div>
        //             </div>
        //         </div>
        //     </div>
        // `;
        
        // document.body.appendChild(modal);
        
        // // Add event listener for closing modal when clicking outside
        // modal.addEventListener('click', (e) => {
        //     if (e.target === modal) {
        //         modal.remove();
        //     }
        // });
        
        // // Add event listener for closing modal with Escape key
        // document.addEventListener('keydown', function closeModal(e) {
        //     if (e.key === 'Escape') {
        //         modal.remove();
        //         document.removeEventListener('keydown', closeModal);
        //     }
        // });
        // }
        
        
        // async function sendEmail(index, email) {
        // const data = leadData.get(index);
        // if (!data) return;
        
        // try {
        //     // Show loading state
        //     const loadingToast = showToast('Sending email...', 'loading');
        
        //     const emailData = {
        //         to: email,
        //         subject: data.emailData.subject,
        //         body: data.emailData.body,
        //         from: 'your-smtp-email@example.com', // Configure with your SMTP email
        //     };
        
        //     // Send email using your SMTP service
        //     const response = await fetch('/api/send-email', {
        //         method: 'POST',
        //         headers: {
        //             'Content-Type': 'application/json',
        //         },
        //         body: JSON.stringify(emailData),
        //     });
        
        //     if (!response.ok) throw new Error('Failed to send email');
        
        //     // Show success message
        //     loadingToast.remove();
        //     showToast('Email sent successfully!', 'success');
            
        //     // Update lead status in the table
        //     updateLeadStatus(index, 'Email Sent');
        
        // } catch (error) {
        //     console.error('Error sending email:', error);
        //     showToast('Failed to send email. Please try again.', 'error');
        // }
        // }
        
        // // Function to copy email content
        // function copyEmailContent(index) {
        // const data = leadData.get(index);
        // if (!data) return;
        
        // const emailContent = `Subject: ${data.emailData.subject}\n\n${data.emailData.body}`;
        
        // navigator.clipboard.writeText(emailContent)
        //     .then(() => showToast('Email copied to clipboard!', 'success'))
        //     .catch(() => showToast('Failed to copy email. Please try again.', 'error'));
        // }
        
        // // Function to export lead data
        // function exportLeadData(index) {
        // const data = leadData.get(index);
        // if (!data) return;
        
        // // Create export data
        // const exportData = {
        //     company: data.emailData.metadata.company,
        //     contact: data.emailData.metadata.contact,
        //     phoneNumbers: data.emailData.phoneNumbers,
        //     emailTemplate: {
        //         subject: data.emailData.subject,
        //         body: data.emailData.body
        //     },
        //     confidence: data.emailData.confidence
        // };
        
        // // Convert to CSV or JSON
        // const fileName = `${data.emailData.company.replace(/[^a-z0-9]/gi, '_').toLowerCase()}_lead_data.json`;
        // const jsonStr = JSON.stringify(exportData, null, 2);
        
        // // Create download link
        // const blob = new Blob([jsonStr], { type: 'application/json' });
        // const url = URL.createObjectURL(blob);
        // const link = document.createElement('a');
        // link.href = url;
        // link.download = fileName;
        
        // // Trigger download
        // document.body.appendChild(link);
        // link.click();
        // document.body.removeChild(link);
        // URL.revokeObjectURL(url);
        
        // showToast('Lead data exported successfully!', 'success');
        // }
        
        // // Toast notification system
        // function showToast(message, type = 'info') {
        // const toast = document.createElement('div');
        // const icons = {
        //     success: `<svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        //                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
        //               </svg>`,
        //     error: `<svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        //               <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        //             </svg>`,
        //     loading: `<div class="animate-spin rounded-full h-5 w-5 border-b-2 border-blue-500"></div>`
        // };
        
        // const colors = {
        //     success: 'bg-green-50 border-green-200 text-green-800',
        //     error: 'bg-red-50 border-red-200 text-red-800',
        //     info: 'bg-blue-50 border-blue-200 text-blue-800',
        //     loading: 'bg-blue-50 border-blue-200 text-blue-800'
        // };
        
        // toast.className = `fixed bottom-4 right-4 flex items-center space-x-2 px-6 py-3 rounded-lg border ${colors[type]} 
        //                   shadow-lg transition-all duration-300 transform translate-y-0 opacity-100 z-50`;
        // toast.innerHTML = `
        //     <div class="flex items-center space-x-2">
        //         ${icons[type] || ''}
        //         <span>${message}</span>
        //     </div>
        // `;
        
        // document.body.appendChild(toast);
        
        // if (type !== 'loading') {
        //     setTimeout(() => {
        //         toast.style.opacity = '0';
        //         toast.style.transform = 'translateY(100%)';
        //         setTimeout(() => toast.remove(), 300);
        //     }, 3000);
        // }
        
        // return toast;
        // }
        
        // // Function to copy text to clipboard
        // function copyToClipboard(text) {
        // navigator.clipboard.writeText(text)
        //     .then(() => showToast('Copied to clipboard!', 'success'))
        //     .catch(() => showToast('Failed to copy text', 'error'));
        // }
        
        // // Function to update lead status in the table
        // function updateLeadStatus(index, status) {
        // const table = document.querySelector('#leads-table table');
        // const rows = table.querySelectorAll('tbody tr');
        // const row = rows[index];
        
        // if (row) {
        //     const statusCell = row.querySelector('.status-cell');
        //     if (statusCell) {
        //         statusCell.innerHTML = `
        //             <div class="flex items-center space-x-2 px-4 py-2 rounded-full bg-green-100 text-green-600">
        //                 <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        //                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
        //                 </svg>
        //                 <span>${status}</span>
        //             </div>
        //         `;
        //     }
        // }
        // }
        
        
        // // Helper functions for data processing
        // async function enrichContactData(lead) {
        // // Simulate API call to contact enrichment service
        // await simulateDelay();
        // return {
        //     'Direct Phone': '+1 (555) 123-4567',
        //     'Mobile': '+1 (555) 987-6543',
        //     'Location': 'San Francisco, CA',
        //     'Department': 'Operations',
        //     'Company Size': '500-1000',
        //     'Industry': 'Medical Devices'
        // };
        // }
        
        // // Helper function to safely access lead properties with different possible key formats
        // function getLeadProperty(lead, properties) {
        // const possibleKeys = {
        //     firstName: ['first_name', 'firstname', 'first name', 'fname'],
        //     lastName: ['last_name', 'lastname', 'last name', 'lname'],
        //     company: ['company', 'company_name', 'companyname'],
        //     title: ['title', 'job_title', 'position'],
        //     email: ['email', 'email_1', 'email-1', 'primary_email']
        // };
        
        // for (const [property, keys] of Object.entries(possibleKeys)) {
        //     if (properties === property) {
        //         for (const key of keys) {
        //             if (lead[key] !== undefined) {
        //                 return lead[key];
        //             }
        //         }
        //     }
        // }
        // return ''; // Return empty string if property not found
        // }
        
        // // Update the scrapeLinkedInData function to use the helper
        // async function scrapeLinkedInData(lead) {
        // // Safely get first and last names
        // const firstName = getLeadProperty(lead, 'firstName') || 'unknown';
        // const lastName = getLeadProperty(lead, 'lastName') || 'unknown';
        
        // // Generate safe URL-friendly name
        // const urlName = `${firstName.toLowerCase()}${lastName.toLowerCase()}`.replace(/[^a-z0-9]/g, '');
        
        // await simulateDelay();
        // return {
        //     'Profile URL': `https://linkedin.com/in/${urlName}`,
        //     'Connections': '500+',
        //     'Experience': '15+ years in Medical Devices',
        //     'Education': 'MBA, Stanford University',
        //     'Recent Activity': 'Posted about medical device innovation'
        // };
        // }
        
        // async function researchCompany(lead) {
        // // Simulate company research
        // await simulateDelay();
        // return {
        //     'Annual Revenue': '$50M - $100M',
        //     'Growth Rate': '12% YoY',
        //     'Technologies': 'Salesforce, HubSpot, Zendesk',
        //     'Recent News': 'Expanded operations to Europe',
        //     'Competitors': 'Company A, Company B, Company C',
        //     'Market Position': 'Top 10 in Medical Devices'
        // };
        // }
        
        
        // function getSelectedLeadsData() {
        // const selectedLeadsData = [];
        // const table = document.querySelector('#leads-table table');
        // const checkboxes = table.querySelectorAll('.lead-checkbox');
        
        // checkboxes.forEach(checkbox => {
        //     if (checkbox.checked) {
        //         const row = checkbox.closest('tr');
        //         const cells = row.querySelectorAll('td');
        //         const leadData = {};
                
        //         // Skip first cell (checkbox) and get data from remaining cells
        //         const headers = table.querySelectorAll('thead th');
        //         for (let i = 1; i < cells.length; i++) {
        //             const header = headers[i].textContent.toLowerCase().replace(/\s+/g, '_');
        //             leadData[header] = cells[i].textContent;
        //         }
                
        //         selectedLeadsData.push(leadData);
        //     }
        // });
        
        // return selectedLeadsData;
        // }
        
        // function findRowByLeadData(table, lead) {
        // const rows = table.querySelectorAll('tbody tr');
        // console.log('Finding row for lead:', lead);
        
        // for (const row of rows) {
        //     const cells = row.querySelectorAll('td');
        //     const rowTexts = Array.from(cells).map(cell => cell.textContent.trim());
            
        //     // Create a matching pattern based on available lead data
        //     const matchPattern = [
        //         lead.company,
        //         lead.first_name,
        //         lead.last_name,
        //         lead.title,
        //         lead.email_1
        //     ].map(val => val?.toString().trim() || '');
        
        //     // Log matching attempt
        //     console.log('Matching pattern:', matchPattern);
        //     console.log('Row texts:', rowTexts);
        
        //     // Check if the row matches the lead data
        //     const matches = matchPattern.every((pattern, index) => {
        //         if (!pattern) return true; // Skip empty patterns
        //         return rowTexts[index]?.includes(pattern);
        //     });
        
        //     if (matches) {
        //         console.log('Found matching row:', rowTexts);
        //         return row;
        //     }
        // }
        
        // console.log('No matching row found');
        // return null;
        // }
        
        // function findCellIndexForKey(table, key) {
        // const headers = table.querySelectorAll('thead th');
        // for (let i = 0; i < headers.length; i++) {
        //     if (headers[i].textContent.toLowerCase().replace(/\s+/g, '_') === key) {
        //         return i;
        //     }
        // }
        // return -1;
        // }
        
        
        
        // function simulateDelay() {
        // return new Promise(resolve => setTimeout(resolve, 100 + Math.random() * 20));
        // }
        
        // // Update the start campaign button event listener
        // // document.getElementById('start-campaign').addEventListener('click', startCampaign);
        
        //     // Add event listener to start campaign button in preview
        //     // document.querySelector('#campaign-preview button:last-child').addEventListener('click', startCampaign);
            
        
        //     function addStatusColumn(table) {
        // const headerRow = table.querySelector('thead tr');
        // const rows = table.querySelectorAll('tbody tr');
        
        // // Add header if it doesn't exist
        // if (!headerRow.querySelector('.status-header')) {
        //     const statusHeader = document.createElement('th');
        //     statusHeader.className = 'status-header px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider';
        //     statusHeader.textContent = 'STATUS';
        //     headerRow.appendChild(statusHeader);
        // }
        
        // // Add status cell to each row
        // rows.forEach((row, index) => {
        //     // Remove existing status cell if any
        //     const existingStatus = row.querySelector('.status-cell');
        //     if (existingStatus) {
        //         existingStatus.remove();
        //     }
        
        //     const statusCell = document.createElement('td');
        //     statusCell.className = 'status-cell px-6 py-4 whitespace-nowrap';
        //     statusCell.innerHTML = `
        //         <div class="flex items-center space-x-2 px-4 py-2 rounded-full bg-gray-100 text-gray-600">
        //             <span>Pending</span>
        //         </div>
        //     `;
            
        //     // Add data attributes for easier row identification
        //     const company = row.cells[0]?.textContent.trim() || '';
        //     const email = row.cells[4]?.textContent.trim() || '';
        //     statusCell.dataset.company = company;
        //     statusCell.dataset.email = email;
        //     statusCell.dataset.rowIndex = index;
            
        //     row.appendChild(statusCell);
        // });
        // }
        
        
        // function showCompletionModal(totalProcessed) {
        // const modal = document.createElement('div');
        // modal.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full';
        // modal.innerHTML = `
        //     <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white dark:bg-gray-800">
        //         <div class="mt-3 text-center">
        //             <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100">
        //                 <svg class="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        //                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
        //                 </svg>
        //             </div>
        //             <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white mt-4">Campaign Processing Complete</h3>
        //             <div class="mt-2 px-7 py-3">
        //                 <p class="text-sm text-gray-500 dark:text-gray-400">
        //                     Successfully processed ${totalProcessed} leads. Click "View Details" on any lead to see the complete data.
        //                 </p>
        //             </div>
        //             <div class="items-center px-4 py-3">
        //                 <button onclick="this.closest('.fixed').remove()"
        //                         class="px-4 py-2 bg-green-500 text-white text-base font-medium rounded-md shadow-sm hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-300">
        //                     OK
        //                 </button>
        //             </div>
        //         </div>
        //     </div>
        // `;
        // document.body.appendChild(modal);
        // }
        
        
        
        // //////////////////////////////////////////////////////////////
        // ////////////////////////GMAIL////////////////////////////////
        // ////////////////////////////////////////////////////////////
        
        // // Gmail Integration JavaScript
        
        // // Generate UUID for this user session if not already set
        // if (!localStorage.getItem('userUuid')) {
        // // For simplicity, we're generating a basic UUID. In a production app, use a proper UUID library
        // const uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        //     const r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
        //     return v.toString(16);
        // });
        // localStorage.setItem('userUuid', uuid);
        // }
        
        // // Get user UUID
        // const userUuid = localStorage.getItem('userUuid');
        // const API_BASE_URL = 'http://localhost:3000'; // Change this to your actual API URL
        
        // // Gmail Integration Handler
        // const gmailIntegration = {
        // init: function() {
        //     // Initialize Gmail integration
        //     this.bindEvents();
        //     this.loadConnectedAccounts();
        // },
        
        // bindEvents: function() {
        //     // Connect Gmail button
        //     document.getElementById('connect-gmail').addEventListener('click', () => {
        //         this.connectGmail();
        //     });
        
        //     // Test connection button
        //     document.getElementById('test-connection').addEventListener('click', () => {
        //         this.testConnection();
        //     });
        // },
        
        // connectGmail: function() {
        //     // Request authorization URL from server
        //     fetch(`${API_BASE_URL}/auth?uuid=${userUuid}`)
        //         .then(response => response.json())
        //         .then(data => {
        //             // Open Gmail authorization in a new window
        //             const authWindow = window.open(data.url, 'GmailAuth', 'width=600,height=700');
                    
        //             // Poll for window close
        //             const checkClosed = setInterval(() => {
        //                 if (authWindow.closed) {
        //                     clearInterval(checkClosed);
        //                     // Reload connected accounts after authorization
        //                     this.loadConnectedAccounts();
        //                 }
        //             }, 1000);
        //         })
        //         .catch(error => {
        //             console.error('Error getting auth URL:', error);
        //             this.showError('Failed to start Gmail authorization');
        //         });
        // },
        
        // loadConnectedAccounts: function() {
        //     // Fetch connected accounts from server
        //     fetch(`${API_BASE_URL}/mailboxes/${userUuid}`)
        //         .then(response => response.json())
        //         .then(data => {
        //             this.updateAccountsList(data.mailboxes);
        //         })
        //         .catch(error => {
        //             console.error('Error loading accounts:', error);
        //             this.showError('Failed to load connected accounts');
        //         });
        // },
        
        // updateAccountsList: function(accounts) {
        //     const accountsList = document.getElementById('accounts-list');
        //     const testEmailAccount = document.getElementById('test-email-account');
        //     const noAccountsMsg = document.getElementById('no-accounts-message');
        //     const testConnectionSection = document.getElementById('test-connection-section');
            
        //     // Update status display
        //     if (accounts.length > 0) {
        //         document.getElementById('no-accounts').classList.add('hidden');
        //         document.getElementById('accounts-connected').classList.remove('hidden');
        //         document.getElementById('accounts-count').textContent = accounts.length;
        //         noAccountsMsg.classList.add('hidden');
        //         testConnectionSection.classList.remove('hidden');
        //     } else {
        //         document.getElementById('no-accounts').classList.remove('hidden');
        //         document.getElementById('accounts-connected').classList.add('hidden');
        //         noAccountsMsg.classList.remove('hidden');
        //         testConnectionSection.classList.add('hidden');
        //     }
            
        //     // Clear existing accounts
        //     accountsList.innerHTML = accounts.length > 0 ? '' : noAccountsMsg.outerHTML;
        //     testEmailAccount.innerHTML = '';
            
        //     // Add connected accounts to the list
        //     accounts.forEach(account => {
        //         // Add to accounts list
        //         const accountItem = document.createElement('div');
        //         accountItem.className = 'flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg';
        //         accountItem.innerHTML = `
        //             <div class="flex items-center">
        //                 <svg class="w-5 h-5 text-red-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        //                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
        //                 </svg>
        //                 <span class="font-medium text-gray-700 dark:text-gray-200">${account}</span>
        //             </div>
        //             // Gmail Integration JavaScript (Continued)
        
        //             <button data-email="${account}" class="remove-account px-2 py-1 text-sm text-red-600 hover:text-red-800 dark:text-red-400">
        //                 Remove
        //             </button>
        //         `;
        //         accountsList.appendChild(accountItem);
                
        //         // Add to select dropdown
        //         const option = document.createElement('option');
        //         option.value = account;
        //         option.textContent = account;
        //         testEmailAccount.appendChild(option);
                
        //         // Add event listener for remove button
        //         accountItem.querySelector('.remove-account').addEventListener('click', (e) => {
        //             this.removeAccount(account);
        //         });
        //     });
            
        //     // Also update campaign form select
        //     this.updateCampaignFormSelect(accounts);
        // },
        
        // updateCampaignFormSelect: function(accounts) {
        //     // Update the sending account select in campaign form
        //     const sendingAccount = document.getElementById('sending-account');
        //     if (sendingAccount) {
        //         // Keep the first option
        //         const firstOption = sendingAccount.options[0];
        //         sendingAccount.innerHTML = '';
        //         sendingAccount.appendChild(firstOption);
                
        //         // Add accounts
        //         accounts.forEach(account => {
        //             const option = document.createElement('option');
        //             option.value = account;
        //             option.textContent = account;
        //             sendingAccount.appendChild(option);
        //         });
        //     }
        // },
        
        // removeAccount: function(account) {
        //     // Send request to remove account
        //     fetch(`${API_BASE_URL}/remove-mailbox`, {
        //         method: 'POST',
        //         headers: {
        //             'Content-Type': 'application/json'
        //         },
        //         body: JSON.stringify({
        //             uuid: userUuid,
        //             mailboxId: account
        //         })
        //     })
        //     .then(response => response.json())
        //     .then(data => {
        //         this.showSuccess(`Removed account: ${account}`);
        //         this.loadConnectedAccounts();
        //     })
        //     .catch(error => {
        //         console.error('Error removing account:', error);
        //         this.showError('Failed to remove account');
        //     });
        // },
        
        // testConnection: function() {
        //     const account = document.getElementById('test-email-account').value;
        //     const testResult = document.getElementById('test-result');
            
        //     if (!account) {
        //         this.showError('Please select an account to test');
        //         return;
        //     }
            
        //     // Show loading state
        //     testResult.innerHTML = `
        //         <div class="flex items-center text-blue-600 dark:text-blue-400">
        //             <svg class="animate-spin -ml-1 mr-3 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        //                 <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        //                 <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        //             </svg>
        //             Testing connection to ${account}...
        //         </div>
        //     `;
        //     testResult.classList.remove('hidden');
            
        //     // Send test request
        //     fetch(`${API_BASE_URL}/test-gmail-connection`, {
        //         method: 'POST',
        //         headers: {
        //             'Content-Type': 'application/json'
        //         },
        //         body: JSON.stringify({
        //             uuid: userUuid,
        //             mailboxId: account
        //         })
        //     })
        //     .then(response => response.json())
        //     .then(data => {
        //         if (data.success) {
        //             testResult.innerHTML = `
        //                 <div class="text-green-600 dark:text-green-400">
        //                     <div class="font-medium">Connected successfully!</div>
        //                     <div class="text-sm">Email: ${data.email}</div>
        //                     <div class="text-sm">Total messages: ${data.messagesTotal}</div>
        //                 </div>
        //             `;
        //             testResult.className = 'mt-3 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg';
        //         } else {
        //             testResult.innerHTML = `
        //                 <div class="text-red-600 dark:text-red-400">
        //                     <div class="font-medium">Connection failed</div>
        //                     <div class="text-sm">${data.error || 'Unknown error'}</div>
        //                 </div>
        //             `;
        //             testResult.className = 'mt-3 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg';
        //         }
        //     })
        //     .catch(error => {
        //         console.error('Error testing connection:', error);
        //         testResult.innerHTML = `
        //             <div class="text-red-600 dark:text-red-400">
        //                 <div class="font-medium">Connection failed</div>
        //                 <div class="text-sm">${error.message || 'Network error'}</div>
        //             </div>
        //         `;
        //         testResult.className = 'mt-3 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg';
        //     });
        // },
        
        // showSuccess: function(message) {
        //     // Show success toast
        //     const toast = document.createElement('div');
        //     toast.className = 'fixed bottom-4 right-4 flex items-center p-4 mb-4 text-green-800 rounded-lg bg-green-50 dark:bg-gray-800 dark:text-green-400';
        //     toast.innerHTML = `
        //         <svg class="flex-shrink-0 w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
        //             <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
        //         </svg>
        //         <div class="ml-3 text-sm font-medium">${message}</div>
        //         <button type="button" class="ml-auto -mx-1.5 -my-1.5 bg-green-50 text-green-500 rounded-lg p-1.5 hover:bg-green-200 inline-flex h-8 w-8 dark:bg-gray-800 dark:text-green-400 dark:hover:bg-gray-700">
        //             <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
        //                 <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
        //             </svg>
        //         </button>
        //     `;
        //     document.body.appendChild(toast);
            
        //     // Remove toast after 3 seconds
        //     setTimeout(() => {
        //         toast.remove();
        //     }, 3000);
            
        //     // Add click event to close button
        //     toast.querySelector('button').addEventListener('click', () => {
        //         toast.remove();
        //     });
        // },
        
        // showError: function(message) {
        //     // Show error toast
        //     const toast = document.createElement('div');
        //     toast.className = 'fixed bottom-4 right-4 flex items-center p-4 mb-4 text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400';
        //     toast.innerHTML = `
        //         <svg class="flex-shrink-0 w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
        //             <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
        //         </svg>
        //         <div class="ml-3 text-sm font-medium">${message}</div>
        //         <button type="button" class="ml-auto -mx-1.5 -my-1.5 bg-red-50 text-red-500 rounded-lg p-1.5 hover:bg-red-200 inline-flex h-8 w-8 dark:bg-gray-800 dark:text-red-400 dark:hover:bg-gray-700">
        //             <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
        //                 <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
        //             </svg>
        //         </button>
        //     `;
        //     document.body.appendChild(toast);
            
        //     // Remove toast after 5 seconds
        //     setTimeout(() => {
        //         toast.remove();
        //     }, 5000);
            
        //     // Add click event to close button
        //     toast.querySelector('button').addEventListener('click', () => {
        //         toast.remove();
        //     });
        // }
        // };
        
        // // Initialize Gmail integration when the tab is switched
        // document.querySelectorAll('.tab-btn').forEach(button => {
        // button.addEventListener('click', () => {
        //     if (button.getAttribute('data-tab') === 'gmail') {
        //         gmailIntegration.init();
        //     }
        // });
        // });
        
        
        // ///////////////////////////////////////////////////////////////////
        // ///////////////////////////CAMPAIGN////////////////////////////////
        
        // // Campaign Manager JavaScript
        
        // // Campaign Manager Handler
        // const campaignManager = {
        // // Store local campaigns data
        // campaigns: [],
        // currentLeads: [],
        // followUpCount: 0,
        
        // init: function() {
        //     // Initialize campaign manager
        //     this.bindEvents();
        //     this.loadCampaigns();
            
        //     // Load current leads if available
        //     const leadsTable = document.querySelector('#leads-table table');
        //     if (leadsTable) {
        //         this.loadCurrentLeads(leadsTable);
        //     }
        // },
        
        // bindEvents: function() {
        //     // Create campaign button
        //     document.getElementById('create-campaign').addEventListener('click', () => {
        //         this.showCampaignModal();
        //     });
            
        //     // Close modal buttons
        //     document.getElementById('close-campaign-modal').addEventListener('click', () => {
        //         this.hideCampaignModal();
        //     });
            
        //     document.getElementById('cancel-campaign').addEventListener('click', () => {
        //         this.hideCampaignModal();
        //     });
            
        //     // Save campaign button
        //     document.getElementById('save-campaign').addEventListener('click', () => {
        //         this.createCampaign();
        //     });
            
        //     // Add follow-up email button
        //     document.getElementById('add-email-step').addEventListener('click', () => {
        //         this.addFollowUpEmail();
        //     });
            
        //     // Lead source change
        //     document.getElementById('lead-source').addEventListener('change', (e) => {
        //         const uploadContainer = document.getElementById('lead-upload-container');
        //         if (e.target.value === 'upload') {
        //             uploadContainer.classList.remove('hidden');
        //         } else {
        //             uploadContainer.classList.add('hidden');
        //         }
        //     });
            
        //     // Modal background click to close
        //     document.getElementById('campaign-modal').addEventListener('click', (e) => {
        //         if (e.target === document.getElementById('campaign-modal')) {
        //             this.hideCampaignModal();
        //         }
        //     });
            
        //     // Lead file change
        //     document.getElementById('lead-file').addEventListener('change', (e) => {
        //         if (e.target.files.length > 0) {
        //             const fileName = e.target.files[0].name;
        //             const fileLabel = e.target.nextElementSibling.querySelector('p');
        //             if (fileLabel) {
        //                 fileLabel.textContent = `Selected file: ${fileName}`;
        //             }
        //             this.processLeadFile(e.target.files[0]);
        //         }
        //     });
        // },
        
        // showCampaignModal: function() {
        //     // Reset form
        //     document.getElementById('campaign-form').reset();
        //     document.getElementById('follow-up-container').innerHTML = '';
        //     this.followUpCount = 0;
            
        //     // Show modal
        //     document.getElementById('campaign-modal').classList.remove('hidden');
        //     document.body.classList.add('overflow-hidden');
        // },
        
        // hideCampaignModal: function() {
        //     document.getElementById('campaign-modal').classList.add('hidden');
        //     document.body.classList.remove('overflow-hidden');
        // },
        
        // loadCampaigns: function() {
        //     // Load campaigns from localStorage
        //     const savedCampaigns = localStorage.getItem('campaigns');
        //     if (savedCampaigns) {
        //         this.campaigns = JSON.parse(savedCampaigns);
        //         this.renderCampaignsList();
        //     }
            
        //     // In a real app, you would fetch campaigns from your backend
        //     // fetch(`${API_BASE_URL}/campaigns/${userUuid}`)
        //     //     .then(response => response.json())
        //     //     .then(data => {
        //     //         this.campaigns = data.campaigns;
        //     //         this.renderCampaignsList();
        //     //     })
        //     //     .catch(error => {
        //     //         console.error('Error loading campaigns:', error);
        //     //     });
        // },
        
        // loadCurrentLeads: function(table) {
        //     // Extract leads from the table
        //     const rows = table.querySelectorAll('tbody tr');
        //     const headers = Array.from(table.querySelectorAll('thead th')).map(th => 
        //         th.textContent.trim().toLowerCase().replace(/\s+/g, '_')
        //     );
            
        //     this.currentLeads = [];
            
        //     rows.forEach(row => {
        //         const leadData = {};
        //         const cells = row.querySelectorAll('td');
                
        //         headers.forEach((header, index) => {
        //             if (cells[index]) {
        //                 leadData[header] = cells[index].textContent.trim();
        //             }
        //         });
                
        //         // Map common fields to standardized names
        //         const lead = {
        //             company: leadData.company || '',
        //             first_name: leadData.first_name || '',
        //             last_name: leadData.last_name || '',
        //             email: leadData.email_1 || leadData.email || '',
        //             title: leadData.title || leadData.job_title || '',
        //             industry: leadData.industry || '',
        //             city: leadData.city || '',
        //             state: leadData.state || '',
        //             revenue: leadData.revenue || leadData.annual_revenue || '',
        //             employees: leadData.employees || '',
        //             website: leadData.website || '',
        //             original_data: leadData // Keep original data
        //         };
                
        //         if (lead.company && lead.email) {
        //             this.currentLeads.push(lead);
        //         }
        //     });
            
        //     console.log(`Loaded ${this.currentLeads.length} leads from current table`);
        // },
        
        // processLeadFile: function(file) {
        //     // For this example, we'll use the Excel.js library that's already loaded
        //     const reader = new FileReader();
            
        //     reader.onload = (e) => {
        //         try {
        //             const data = new Uint8Array(e.target.result);
        //             const workbook = XLSX.read(data, { type: 'array' });
                    
        //             // Get first worksheet
        //             const worksheetName = workbook.SheetNames[0];
        //             const worksheet = workbook.Sheets[worksheetName];
                    
        //             // Convert to JSON
        //             const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
        //             // Map to standardized lead format
        //             this.uploadedLeads = jsonData.map(row => {
        //                 // Try to find keys case-insensitively
        //                 const getValueByKey = (keysToTry) => {
        //                     for (const key of keysToTry) {
        //                         for (const rowKey in row) {
        //                             if (rowKey.toLowerCase().includes(key.toLowerCase())) {
        //                                 return row[rowKey];
        //                             }
        //                         }
        //                     }
        //                     return '';
        //                 };
                        
        //                 return {
        //                     company: getValueByKey(['company', 'organization']),
        //                     first_name: getValueByKey(['first_name', 'firstname', 'first']),
        //                     last_name: getValueByKey(['last_name', 'lastname', 'last']),
        //                     email: getValueByKey(['email', 'email_1', 'email-1']),
        //                     title: getValueByKey(['title', 'job_title', 'position']),
        //                     industry: getValueByKey(['industry', 'sector']),
        //                     city: getValueByKey(['city']),
        //                     state: getValueByKey(['state', 'province']),
        //                     revenue: getValueByKey(['revenue', 'annual_revenue']),
        //                     employees: getValueByKey(['employees', 'employee_count']),
        //                     website: getValueByKey(['website', 'url']),
        //                     original_data: row // Keep original data
        //                 };
        //             }).filter(lead => lead.email && lead.company); // Only keep leads with email and company
                    
        //             this.showSuccess(`Loaded ${this.uploadedLeads.length} leads from file`);
        //         } catch (error) {
        //             console.error('Error processing file:', error);
        //             this.showError('Failed to process lead file');
        //         }
        //     };
            
        //     reader.onerror = (e) => {
        //         console.error('Error reading file:', e);
        //         this.showError('Failed to read lead file');
        //     };
            
        //     reader.readAsArrayBuffer(file);
        // },
        
        // renderCampaignsList: function() {
        //     const campaignsList = document.getElementById('campaigns-list');
            
        //     if (this.campaigns.length === 0) {
        //         campaignsList.innerHTML = `
        //             <tr>
        //                 <td colspan="6" class="px-6 py-4 text-center text-gray-500 dark:text-gray-400">
        //                     No campaigns created yet.
        //                 </td>
        //             </tr>
        //         `;
        //         return;
        //     }
            
        //     campaignsList.innerHTML = '';
            
        //     this.campaigns.forEach((campaign, index) => {
        //         const row = document.createElement('tr');
        //         row.innerHTML = `
        //             <td class="px-6 py-4 whitespace-nowrap">
        //                 <div class="font-medium text-gray-900 dark:text-white">${campaign.name}</div>
        //             </td>
        //             <td class="px-6 py-4 whitespace-nowrap">
        //                 <span class="px-2 py-1 text-xs rounded-full ${this.getStatusClass(campaign.status)}">
        //                     ${campaign.status}
        //                 </span>
        //             </td>
        //             <td class="px-6 py-4 whitespace-nowrap text-gray-500 dark:text-gray-400">
        //                 ${campaign.leadCount}
        //             </td>
        //             <td class="px-6 py-4 whitespace-nowrap text-gray-500 dark:text-gray-400">
        //                 ${campaign.sentCount} / ${campaign.leadCount}
        //             </td>
        //             <td class="px-6 py-4 whitespace-nowrap text-gray-500 dark:text-gray-400">
        //                 ${campaign.nextFollowUp ? new Date(campaign.nextFollowUp).toLocaleString() : 'N/A'}
        //             </td>
        //             <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
        //                 <button data-campaign-index="${index}" class="view-campaign text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300 mr-3">
        //                     View
        //                 </button>
        //                 <button data-campaign-index="${index}" class="pause-campaign ${campaign.status === 'Paused' ? 'hidden' : ''} text-orange-600 hover:text-orange-900 dark:text-orange-400 dark:hover:text-orange-300 mr-3">
        //                     Pause
        //                 </button>
        //                 <button data-campaign-index="${index}" class="resume-campaign ${campaign.status !== 'Paused' ? 'hidden' : ''} text-green-600 hover:text-green-900 dark:text-green-400 dark:hover:text-green-300 mr-3">
        //                     Resume
        //                 </button>
        //                 <button data-campaign-index="${index}" class="delete-campaign text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300">
        //                     Delete
        //                 </button>
        //             </td>
        //         `;
                
        //         campaignsList.appendChild(row);
                
        //         // Add event listeners
        //         row.querySelector('.view-campaign').addEventListener('click', () => {
        //             this.viewCampaign(index);
        //         });
                
        //         row.querySelector('.pause-campaign')?.addEventListener('click', () => {
        //             this.pauseCampaign(index);
        //         });
                
        //         row.querySelector('.resume-campaign')?.addEventListener('click', () => {
        //             this.resumeCampaign(index);
        //         });
                
        //         row.querySelector('.delete-campaign').addEventListener('click', () => {
        //             this.deleteCampaign(index);
        //         });
        //     });
        // },
        
        // getStatusClass: function(status) {
        //     switch (status) {
        //         case 'Active':
        //             return 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300';
        //         case 'Paused':
        //             return 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300';
        //         case 'Completed':
        //             return 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300';
        //         case 'Draft':
        //             return 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300';
        //         default:
        //             return 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300';
        //     }
        // },
        
        // addFollowUpEmail: function() {
        //     this.followUpCount++;
            
        //     // Clone the template
        //     const template = document.getElementById('follow-up-template');
        //     const clone = document.importNode(template.content, true);
            
        //     // Update the follow-up number
        //     clone.querySelector('.follow-up-number').textContent = this.followUpCount;
            
        //     // Add event listener to remove button
        //     clone.querySelector('.remove-follow-up').addEventListener('click', (e) => {
        //         e.target.closest('.follow-up-email').remove();
        //         this.updateFollowUpNumbers();
        //     });
            
        //     // Append to container
        //     document.getElementById('follow-up-container').appendChild(clone);
        // },
        
        // updateFollowUpNumbers: function() {
        //     // Update follow-up email numbers
        //     const followUps = document.querySelectorAll('.follow-up-email');
        //     followUps.forEach((followUp, index) => {
        //         followUp.querySelector('.follow-up-number').textContent = index + 1;
        //     });
        //     this.followUpCount = followUps.length;
        // },
        
        // createCampaign: function() {
        //     // Validate form
        //     const campaignName = document.getElementById('campaign-name').value;
        //     const sendingAccount = document.getElementById('sending-account').value;
            
        //     if (!campaignName) {
        //         this.showError('Please enter a campaign name');
        //         return;
        //     }
            
        //     if (!sendingAccount) {
        //         this.showError('Please select a sending account');
        //         return;
        //     }
            
        //     // Get leads
        //     const leadSource = document.getElementById('lead-source').value;
        //     let leads = [];
            
        //     if (leadSource === 'current') {
        //         if (this.currentLeads.length === 0) {
        //             this.showError('No leads available in the current table');
        //             return;
        //         }
        //         leads = this.currentLeads;
        //     } else if (leadSource === 'upload') {
        //         if (!this.uploadedLeads || this.uploadedLeads.length === 0) {
        //             this.showError('Please upload a leads file');
        //             return;
        //         }
        //         leads = this.uploadedLeads;
        //     }
            
        //     // Get email sequence
        //     const initialEmail = {
        //         subject: document.querySelector('.email-subject').value,
        //         body: document.querySelector('.email-body').value,
        //         sendDate: document.querySelector('.email-date').value,
        //         sendSpeed: document.querySelector('.email-speed').value
        //     };
            
        //     if (!initialEmail.subject || !initialEmail.body) {
        //         this.showError('Please enter subject and body for the initial email');
        //         return;
        //     }
            
        //     if (!initialEmail.sendDate) {
        //         initialEmail.sendDate = new Date().toISOString().slice(0, 16); // Set to now
        //     }
            
        //     // Get follow-up emails
        //     const followUpEmails = [];
        //     const followUpContainers = document.querySelectorAll('.follow-up-email');
            
        //     followUpContainers.forEach((container, index) => {
        //         const subject = container.querySelector('.email-subject').value;
        //         const body = container.querySelector('.email-body').value;
        //         const waitDuration = parseInt(container.querySelector('.wait-duration').value) || 1;
        //         const waitUnit = container.querySelector('.wait-unit').value;
                
        //         if (subject && body) {
        //             followUpEmails.push({
        //                 subject,
        //                 body,
        //                 waitDuration,
        //                 waitUnit
        //             });
        //         }
        //     });
            
        //     // Get additional settings
        //     const trackOpens = document.getElementById('track-opens').checked;
        //     const trackClicks = document.getElementById('track-clicks').checked;
        //     const stopOnReply = document.getElementById('stop-on-reply').checked;
        //     const stopOnClick = document.getElementById('stop-on-click').checked;
            
        //     // Create campaign object
        //     const campaign = {
        //         id: Date.now().toString(),
        //         name: campaignName,
        //         sendingAccount: sendingAccount,
        //         leads: leads,
        //         leadCount: leads.length,
        //         initialEmail: initialEmail,
        //         followUpEmails: followUpEmails,
        //         settings: {
        //             trackOpens,
        //             trackClicks,
        //             stopOnReply,
        //             stopOnClick
        //         },
        //         status: 'Active',
        //         sentCount: 0,
        //         openCount: 0,
        //         clickCount: 0,
        //         replyCount: 0,
        //         createdAt: new Date().toISOString(),
        //         nextFollowUp: initialEmail.sendDate
        //     };
            
        //     // Add to campaigns list
        //     this.campaigns.push(campaign);
            
        //     // Save to localStorage
        //     localStorage.setItem('campaigns', JSON.stringify(this.campaigns));
            
        //     // In a real app, you would send this to your backend
        //     // fetch(`${API_BASE_URL}/campaigns`, {
        //     //     method: 'POST',
        //     //     headers: {
        //     //         'Content-Type': 'application/json'
        //     //     },
        //     //     body: JSON.stringify({
        //     //         uuid: userUuid,
        //     //         campaign: campaign
        //     //     })
        //     // })
            
        //     // Hide modal and update UI
        //     this.hideCampaignModal();
        //     this.renderCampaignsList();
        //     this.showSuccess('Campaign created successfully');
            
        //     // In a real app, you would start the campaign here
        //     // this.startCampaign(campaign);
        // },
        
        // startCampaign: function(campaign) {
        //     // In a real app, you would call your backend API to start the campaign
        //     fetch(`${API_BASE_URL}/campaign/send`, {
        //         method: 'POST',
        //         headers: {
        //             'Content-Type': 'application/json'
        //         },
        //         body: JSON.stringify({
        //             uuid: userUuid,
        //             mailboxId: campaign.sendingAccount,
        //             emails: campaign.leads.map(lead => ({
        //                 to: lead.email,
        //                 subject: this.replacePlaceholders(campaign.initialEmail.subject, lead),
        //                 body: this.replacePlaceholders(campaign.initialEmail.body, lead)
        //             })),
        //             campaignName: campaign.name,
        //             sendInterval: this.getSendIntervalSeconds(campaign.initialEmail.sendSpeed)
        //         })
        //     })
        //     .then(response => response.json())
        //     .then(data => {
        //         if (data.success) {
        //             this.showSuccess(`Campaign "${campaign.name}" started`);
        //         } else {
        //             this.showError(`Failed to start campaign: ${data.error}`);
        //         }
        //     })
        //     .catch(error => {
        //         console.error('Error starting campaign:', error);
        //         this.showError('Failed to start campaign');
        //     });
        // },
        
        // getSendIntervalSeconds: function(speed) {
        //     switch (speed) {
        //         case 'slow': return 120; // 2 minutes
        //         case 'medium': return 60; // 1 minute
        //         case 'fast': return 20; // 3 per minute
        //         default: return 60;
        //     }
        // },
        
        // // Campaign Manager JavaScript (Continued)
        // replacePlaceholders: function(text, lead) {
        //     return text
        //         .replace(/{first_name}/gi, lead.first_name || '')
        //         .replace(/{last_name}/gi, lead.last_name || '')
        //         .replace(/{company}/gi, lead.company || '')
        //         .replace(/{title}/gi, lead.title || '')
        //         .replace(/{industry}/gi, lead.industry || '')
        //         .replace(/{city}/gi, lead.city || '')
        //         .replace(/{state}/gi, lead.state || '')
        //         .replace(/{revenue}/gi, lead.revenue || '')
        //         .replace(/{employees}/gi, lead.employees || '')
        //         .replace(/{website}/gi, lead.website || '')
        //         .replace(/{email}/gi, lead.email || '');
        // },
        
        // viewCampaign: function(index) {
        //     const campaign = this.campaigns[index];
            
        //     // Create and show campaign details modal
        //     const modal = document.createElement('div');
        //     modal.className = 'fixed inset-0 z-50 overflow-y-auto';
        //     modal.innerHTML = `
        //         <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        //             <div class="fixed inset-0 transition-opacity" aria-hidden="true">
        //                 <div class="absolute inset-0 bg-black bg-opacity-50"></div>
        //             </div>
                    
        //             <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl w-full">
        //                 <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
        //                     <div class="sm:flex sm:items-start">
        //                         <div class="w-full">
        //                             <div class="flex justify-between items-center mb-4">
        //                                 <h3 class="text-xl leading-6 font-medium text-gray-900 dark:text-white">
        //                                     Campaign Details: ${campaign.name}
        //                                 </h3>
        //                                 <span class="px-2 py-1 text-xs rounded-full ${this.getStatusClass(campaign.status)}">
        //                                     ${campaign.status}
        //                                 </span>
        //                             </div>
                                    
        //                             <div class="mt-2 divide-y divide-gray-200 dark:divide-gray-700">
        //                                 <!-- Campaign Stats -->
        //                                 <div class="py-4">
        //                                     <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-3">Campaign Statistics</h4>
        //                                     <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        //                                         <div class="bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg">
        //                                             <div class="text-sm text-blue-800 dark:text-blue-200">Total Leads</div>
        //                                             <div class="text-2xl font-bold text-blue-900 dark:text-blue-100">${campaign.leadCount}</div>
        //                                         </div>
        //                                         <div class="bg-green-50 dark:bg-green-900/20 p-3 rounded-lg">
        //                                             <div class="text-sm text-green-800 dark:text-green-200">Emails Sent</div>
        //                                             <div class="text-2xl font-bold text-green-900 dark:text-green-100">${campaign.sentCount}</div>
        //                                         </div>
        //                                         <div class="bg-yellow-50 dark:bg-yellow-900/20 p-3 rounded-lg">
        //                                             <div class="text-sm text-yellow-800 dark:text-yellow-200">Opens</div>
        //                                             <div class="text-2xl font-bold text-yellow-900 dark:text-yellow-100">${campaign.openCount || 0}</div>
        //                                         </div>
        //                                         <div class="bg-purple-50 dark:bg-purple-900/20 p-3 rounded-lg">
        //                                             <div class="text-sm text-purple-800 dark:text-purple-200">Replies</div>
        //                                             <div class="text-2xl font-bold text-purple-900 dark:text-purple-100">${campaign.replyCount || 0}</div>
        //                                         </div>
        //                                     </div>
        //                                 </div>
                                        
        //                                 <!-- Campaign Emails -->
        //                                 <div class="py-4">
        //                                     <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-3">Email Sequence</h4>
                                            
        //                                     <!-- Initial Email -->
        //                                     <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg mb-3">
        //                                         <div class="font-medium text-gray-900 dark:text-white mb-1">Initial Email</div>
        //                                         <div class="text-sm text-gray-800 dark:text-gray-200 mb-1">
        //                                             <span class="font-medium">Subject:</span> ${campaign.initialEmail.subject}
        //                                         </div>
        //                                         <div class="text-sm text-gray-600 dark:text-gray-300 whitespace-pre-line border-t border-gray-200 dark:border-gray-600 pt-2 mt-2">
        //                                             ${campaign.initialEmail.body}
        //                                         </div>
        //                                         <div class="text-xs text-gray-500 dark:text-gray-400 mt-2">
        //                                             Send date: ${new Date(campaign.initialEmail.sendDate).toLocaleString()}
        //                                         </div>
        //                                     </div>
                                            
        //                                     <!-- Follow-up Emails -->
        //                                     ${campaign.followUpEmails.map((email, i) => `
        //                                         <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg mb-2">
        //                                             <div class="font-medium text-gray-900 dark:text-white mb-1">Follow-up Email ${i + 1}</div>
        //                                             <div class="text-sm text-gray-800 dark:text-gray-200 mb-1">
        //                                                 <span class="font-medium">Subject:</span> ${email.subject}
        //                                             </div>
        //                                             <div class="text-sm text-gray-600 dark:text-gray-300 whitespace-pre-line border-t border-gray-200 dark:border-gray-600 pt-2 mt-2">
        //                                                 ${email.body}
        //                                             </div>
        //                                             <div class="text-xs text-gray-500 dark:text-gray-400 mt-2">
        //                                                 Wait: ${email.waitDuration} ${email.waitUnit}
        //                                             </div>
        //                                         </div>
        //                                     `).join('')}
        //                                 </div>
                                        
        //                                 <!-- Campaign Settings -->
        //                                 <div class="py-4">
        //                                     <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-3">Settings</h4>
        //                                     <div class="grid grid-cols-2 gap-4">
        //                                         <div class="text-sm">
        //                                             <span class="font-medium text-gray-900 dark:text-white">Sending Account:</span>
        //                                             <span class="text-gray-600 dark:text-gray-300 ml-2">${campaign.sendingAccount}</span>
        //                                         </div>
        //                                         <div class="text-sm">
        //                                             <span class="font-medium text-gray-900 dark:text-white">Send Speed:</span>
        //                                             <span class="text-gray-600 dark:text-gray-300 ml-2">${campaign.initialEmail.sendSpeed}</span>
        //                                         </div>
        //                                         <div class="text-sm">
        //                                             <span class="font-medium text-gray-900 dark:text-white">Track Opens:</span>
        //                                             <span class="text-gray-600 dark:text-gray-300 ml-2">${campaign.settings.trackOpens ? 'Yes' : 'No'}</span>
        //                                         </div>
        //                                         <div class="text-sm">
        //                                             <span class="font-medium text-gray-900 dark:text-white">Track Clicks:</span>
        //                                             <span class="text-gray-600 dark:text-gray-300 ml-2">${campaign.settings.trackClicks ? 'Yes' : 'No'}</span>
        //                                         </div>
        //                                         <div class="text-sm">
        //                                             <span class="font-medium text-gray-900 dark:text-white">Stop on Reply:</span>
        //                                             <span class="text-gray-600 dark:text-gray-300 ml-2">${campaign.settings.stopOnReply ? 'Yes' : 'No'}</span>
        //                                         </div>
        //                                         <div class="text-sm">
        //                                             <span class="font-medium text-gray-900 dark:text-white">Stop on Click:</span>
        //                                             <span class="text-gray-600 dark:text-gray-300 ml-2">${campaign.settings.stopOnClick ? 'Yes' : 'No'}</span>
        //                                         </div>
        //                                     </div>
        //                                 </div>
        //                             </div>
        //                         </div>
        //                     </div>
        //                 </div>
        //                 <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
        //                     <button type="button" class="close-modal w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm">
        //                         Close
        //                     </button>
        //                 </div>
        //             </div>
        //         </div>
        //     `;
            
        //     document.body.appendChild(modal);
            
        //     // Add event listener to close button
        //     modal.querySelector('.close-modal').addEventListener('click', () => {
        //         modal.remove();
        //     });
            
        //     // Close modal when clicking outside
        //     modal.querySelector('.fixed.inset-0').addEventListener('click', () => {
        //         modal.remove();
        //     });
        // },
        
        // pauseCampaign: function(index) {
        //     // Update campaign status
        //     this.campaigns[index].status = 'Paused';
            
        //     // Save to localStorage
        //     localStorage.setItem('campaigns', JSON.stringify(this.campaigns));
            
        //     // Update UI
        //     this.renderCampaignsList();
        //     this.showSuccess(`Campaign "${this.campaigns[index].name}" paused`);
            
        //     // In a real app, you would call your backend API to pause the campaign
        //     // fetch(`${API_BASE_URL}/campaign/pause`, {
        //     //     method: 'POST',
        //     //     headers: {
        //     //         'Content-Type': 'application/json'
        //     //     },
        //     //     body: JSON.stringify({
        //     //         uuid: userUuid,
        //     //         campaignId: this.campaigns[index].id
        //     //     })
        //     // });
        // },
        
        // resumeCampaign: function(index) {
        //     // Update campaign status
        //     this.campaigns[index].status = 'Active';
            
        //     // Save to localStorage
        //     localStorage.setItem('campaigns', JSON.stringify(this.campaigns));
            
        //     // Update UI
        //     this.renderCampaignsList();
        //     this.showSuccess(`Campaign "${this.campaigns[index].name}" resumed`);
            
        //     // In a real app, you would call your backend API to resume the campaign
        //     // fetch(`${API_BASE_URL}/campaign/resume`, {
        //     //     method: 'POST',
        //     //     headers: {
        //     //         'Content-Type': 'application/json'
        //     //     },
        //     //     body: JSON.stringify({
        //     //         uuid: userUuid,
        //     //         campaignId: this.campaigns[index].id
        //     //     })
        //     // });
        // },
        
        // deleteCampaign: function(index) {
        //     // Confirm deletion
        //     if (!confirm(`Are you sure you want to delete the campaign "${this.campaigns[index].name}"?`)) {
        //         return;
        //     }
            
        //     // Remove campaign
        //     const campaignName = this.campaigns[index].name;
        //     this.campaigns.splice(index, 1);
            
        //     // Save to localStorage
        //     localStorage.setItem('campaigns', JSON.stringify(this.campaigns));
            
        //     // Update UI
        //     this.renderCampaignsList();
        //     this.showSuccess(`Campaign "${campaignName}" deleted`);
            
        //     // In a real app, you would call your backend API to delete the campaign
        //     // fetch(`${API_BASE_URL}/campaign/delete`, {
        //     //     method: 'POST',
        //     //     headers: {
        //     //         'Content-Type': 'application/json'
        //     //     },
        //     //     body: JSON.stringify({
        //     //         uuid: userUuid,
        //     //         campaignId: campaignId
        //     //     })
        //     // });
        // },
        
        // showSuccess: function(message) {
        //     // Show success toast
        //     const toast = document.createElement('div');
        //     toast.className = 'fixed bottom-4 right-4 flex items-center p-4 mb-4 text-green-800 rounded-lg bg-green-50 dark:bg-gray-800 dark:text-green-400';
        //     toast.innerHTML = `
        //         <svg class="flex-shrink-0 w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
        //             <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
        //         </svg>
        //         <div class="ml-3 text-sm font-medium">${message}</div>
        //         <button type="button" class="ml-auto -mx-1.5 -my-1.5 bg-green-50 text-green-500 rounded-lg p-1.5 hover:bg-green-200 inline-flex h-8 w-8 dark:bg-gray-800 dark:text-green-400 dark:hover:bg-gray-700">
        //             <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
        //                 <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
        //             </svg>
        //         </button>
        //     `;
        //     document.body.appendChild(toast);
            
        //     // Remove toast after 3 seconds
        //     setTimeout(() => {
        //         toast.remove();
        //     }, 3000);
            
        //     // Add click event to close button
        //     toast.querySelector('button').addEventListener('click', () => {
        //         toast.remove();
        //     });
        // },
        
        // showError: function(message) {
        //     // Show error toast
        //     const toast = document.createElement('div');
        //     toast.className = 'fixed bottom-4 right-4 flex items-center p-4 mb-4 text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400';
        //     toast.innerHTML = `
        //         <svg class="flex-shrink-0 w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
        //             <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
        //         </svg>
        //         <div class="ml-3 text-sm font-medium">${message}</div>
        //         <button type="button" class="ml-auto -mx-1.5 -my-1.5 bg-red-50 text-red-500 rounded-lg p-1.5 hover:bg-red-200 inline-flex h-8 w-8 dark:bg-gray-800 dark:text-red-400 dark:hover:bg-gray-700">
        //             <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
        //                 <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
        //             </svg>
        //         </button>
        //     `;
        //     document.body.appendChild(toast);
            
        //     // Remove toast after 5 seconds
        //     setTimeout(() => {
        //         toast.remove();
        //     }, 5000);
            
        //     // Add click event to close button
        //     toast.querySelector('button').addEventListener('click', () => {
        //         toast.remove();
        //     });
        // }
        // };
        
        // // Initialize Campaign Manager when the tab is switched
        // document.querySelectorAll('.tab-btn').forEach(button => {
        // button.addEventListener('click', () => {
        //     if (button.getAttribute('data-tab') === 'campaigns-manager') {
        //         campaignManager.init();
        //     }
        // });
        // });
        
        
        </script>
</body>
</html>


